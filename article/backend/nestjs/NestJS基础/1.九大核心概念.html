<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>许小墨のGuide | 许小墨のGuide</title>
    <meta name="description" content="分享前沿学习干货，不止前端">
    <link rel="preload stylesheet" href="/xuxiaomo.guide/assets/style.e71ae551.css" as="style">
    
    <script type="module" src="/xuxiaomo.guide/assets/app.de7e8645.js"></script>
    <link rel="preload" href="/xuxiaomo.guide/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/xuxiaomo.guide/assets/chunks/framework.ab7e7ee0.js">
    <link rel="modulepreload" href="/xuxiaomo.guide/assets/chunks/theme.9632d959.js">
    <link rel="modulepreload" href="/xuxiaomo.guide/assets/article_backend_nestjs_NestJS基础_1.九大核心概念.md.dafdc3d7.lean.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a346dfe><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a346dfe data-v-ae24b3ad><div class="VPNavBar has-sidebar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle has-sidebar" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/xuxiaomo.guide/" data-v-86d1bed8><!--[--><!--]--><!--[--><img class="VPImage logo" src="/xuxiaomo.guide/common/avatar.png" alt data-v-8426fc1a><!--]--><!--[-->许小墨のGuide<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a0fd61f4><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/xuxiaomo.guide/" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>个人成长</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Travel/" data-v-43f1e123><!--[-->大江南北游记<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Growing/" data-v-43f1e123><!--[-->所思·所想<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>干货社区</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/BaseCommand/" data-v-43f1e123><!--[-->快捷键<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Template/" data-v-43f1e123><!--[-->模板管理<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>精选专栏</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Algorithm/" data-v-43f1e123><!--[-->数构与前端<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Interview/" data-v-43f1e123><!--[-->offer来了<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>分类索引</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Product/" data-v-43f1e123><!--[-->产品汪<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/FrontEnd/" data-v-43f1e123><!--[-->前端开发<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/OtherLang/" data-v-43f1e123><!--[-->其他语言<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/BackEnd/" data-v-43f1e123><!--[-->服务端开发<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/ComputerKnowledge/" data-v-43f1e123><!--[-->计算机基础知识<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/column/Growing/" data-v-43f1e123><!--[-->碎碎念个人成长<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>其他</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/article/bigMan/" data-v-43f1e123><!--[-->巨人的肩膀<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/article/bug/" data-v-43f1e123><!--[-->bug集中营<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/xuxiaomo.guide/article/colorfulLife/" data-v-43f1e123><!--[-->缤纷世界<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-9c007e85><span class="text" data-v-9c007e85><!----><span data-v-9c007e85>关于我</span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-9c007e85><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://blog.csdn.net/qq_60306931" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->CSDN<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://github.com/Angelxyj" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->Github<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://gitee.com/Angelxyj" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->Gitee<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://angelxyj.gitee.io/xuxiaomo.blog" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->私人博客<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link vp-external-link-icon" href="https://angelxyj.gitee.io/xuxiaomo.docs" target="_blank" rel="noreferrer" data-v-43f1e123><!--[-->技术文档<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://juejin.cn/user/822915483571063" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg t="1671070837286" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="878" width="200" height="200"><path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-0.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-0.586 0.147-19.896 14.922-42.862 33.061z m233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-0.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-0.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-0.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-0.878-1.17-57.637-47.104-59.978-48.274-0.731-0.439-18.578 12.727-39.497 29.257z" fill="#006CFF" p-id="879"></path><path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-0.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027 0.732 0.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852 0.878-0.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607 0.44-0.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73 0.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-0.439 0.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-0.439-0.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-0.878-0.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-0.439-0.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-0.877 0-14.043 10.24-29.257 22.528z" fill="#006CFF" p-id="880"></path></svg></a><a class="VPSocialLink no-icon" href="https://gitee.com/Angelxyj" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg t="1671071196762" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1978" width="200" height="200"><path d="M932.317184 567.76704L885.10464 422.46144l-93.57312-287.997952c-4.8128-14.81728-25.776128-14.81728-30.590976 0L667.36128 422.459392H356.62848L263.051264 134.46144c-4.8128-14.81728-25.776128-14.81728-30.593024 0l-93.57312 287.997952-47.210496 145.309696a32.165888 32.165888 0 0 0 11.68384 35.96288l408.6272 296.890368L920.61696 603.734016c11.272192-8.192 15.990784-22.71232 11.68384-35.964928" fill="#FC6D26" p-id="1979"></path><path d="M512.002048 900.62848l155.365376-478.171136H356.634624z" fill="#E24329" p-id="1980"></path><path d="M512.004096 900.62848L356.63872 422.47168H138.901504z" fill="#FC6D26" p-id="1981"></path><path d="M138.891264 422.465536l-47.214592 145.309696a32.16384 32.16384 0 0 0 11.685888 35.96288L511.991808 900.62848z" fill="#FCA326" p-id="1982"></path><path d="M138.893312 422.459392h217.737216L263.053312 134.46144c-4.8128-14.819328-25.778176-14.819328-30.590976 0z" fill="#E24329" p-id="1983"></path><path d="M512.002048 900.62848l155.365376-478.154752H885.10464z" fill="#FC6D26" p-id="1984"></path><path d="M885.11488 422.465536l47.214592 145.309696a32.16384 32.16384 0 0 1-11.685888 35.96288L512.014336 900.62848z" fill="#FCA326" p-id="1985"></path><path d="M885.096448 422.459392H667.36128l93.577216-287.997952c4.814848-14.819328 25.778176-14.819328 30.590976 0z" fill="#E24329" p-id="1986"></path></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Angelxyj" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-40855f84 data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-40855f84 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://juejin.cn/user/822915483571063" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg t="1671070837286" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="878" width="200" height="200"><path d="M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-0.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-0.586 0.147-19.896 14.922-42.862 33.061z m233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-0.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-0.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-0.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-0.878-1.17-57.637-47.104-59.978-48.274-0.731-0.439-18.578 12.727-39.497 29.257z" fill="#006CFF" p-id="879"></path><path d="M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-0.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027 0.732 0.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852 0.878-0.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607 0.44-0.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73 0.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-0.439 0.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-0.439-0.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-0.878-0.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-0.439-0.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-0.877 0-14.043 10.24-29.257 22.528z" fill="#006CFF" p-id="880"></path></svg></a><a class="VPSocialLink no-icon" href="https://gitee.com/Angelxyj" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg t="1671071196762" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1978" width="200" height="200"><path d="M932.317184 567.76704L885.10464 422.46144l-93.57312-287.997952c-4.8128-14.81728-25.776128-14.81728-30.590976 0L667.36128 422.459392H356.62848L263.051264 134.46144c-4.8128-14.81728-25.776128-14.81728-30.593024 0l-93.57312 287.997952-47.210496 145.309696a32.165888 32.165888 0 0 0 11.68384 35.96288l408.6272 296.890368L920.61696 603.734016c11.272192-8.192 15.990784-22.71232 11.68384-35.964928" fill="#FC6D26" p-id="1979"></path><path d="M512.002048 900.62848l155.365376-478.171136H356.634624z" fill="#E24329" p-id="1980"></path><path d="M512.004096 900.62848L356.63872 422.47168H138.901504z" fill="#FC6D26" p-id="1981"></path><path d="M138.891264 422.465536l-47.214592 145.309696a32.16384 32.16384 0 0 0 11.685888 35.96288L511.991808 900.62848z" fill="#FCA326" p-id="1982"></path><path d="M138.893312 422.459392h217.737216L263.053312 134.46144c-4.8128-14.819328-25.778176-14.819328-30.590976 0z" fill="#E24329" p-id="1983"></path><path d="M512.002048 900.62848l155.365376-478.154752H885.10464z" fill="#FC6D26" p-id="1984"></path><path d="M885.11488 422.465536l47.214592 145.309696a32.16384 32.16384 0 0 1-11.685888 35.96288L512.014336 900.62848z" fill="#FCA326" p-id="1985"></path><path d="M885.096448 422.459392H667.36128l93.577216-287.997952c4.814848-14.819328 25.778176-14.819328 30.590976 0z" fill="#E24329" p-id="1986"></path></svg></a><a class="VPSocialLink no-icon" href="https://github.com/Angelxyj" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-5a346dfe data-v-79c8c1df><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-79c8c1df><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-79c8c1df><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-79c8c1df>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-5a346dfe data-v-b00e2fdd><div class="curtain" data-v-b00e2fdd></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-b00e2fdd><span class="visually-hidden" id="sidebar-aria-label" data-v-b00e2fdd> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible has-active" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>NestJS基础</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/1.%E4%B9%9D%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>1.九大核心概念</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%B0%8F%E7%BB%93.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>2.核心概念小结</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/3.ExecutionContext%E8%A1%A5%E5%85%85.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>3.ExecutionContext补充</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>NestJS进阶</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/1.%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>1.依赖注入</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/2.%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>2.生命周期</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/3.%E6%89%93%E5%8C%85%E9%83%A8%E7%BD%B2(%E2%9A%91).html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>3.打包部署(⚑)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/4.%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>4.环境变量</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/5.%E6%95%B4%E5%90%88prisma(todo).html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>5.整合prisma(todo)</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E8%BF%9B%E9%98%B6/6.%E7%BC%93%E5%AD%98(todo).html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>6.缓存(todo)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>安全认证</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/%E5%AE%89%E5%85%A8%E8%AE%A4%E8%AF%81/1.%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81(JWT).html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>1.登录认证(JWT)</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-b00e2fdd><section class="VPSidebarItem level-0 collapsible" data-v-b00e2fdd data-v-e31bd47b><div class="item" role="button" tabindex="0" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><h2 class="text" data-v-e31bd47b>实用工具包</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-e31bd47b><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-e31bd47b><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-e31bd47b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-e31bd47b data-v-e31bd47b><div class="item" data-v-e31bd47b><div class="indicator" data-v-e31bd47b></div><a class="VPLink link link" href="/xuxiaomo.guide/article/backend/nestjs/%E5%AE%9E%E7%94%A8%E5%B7%A5%E5%85%B7%E5%8C%85/1.class-transformer.html" data-v-e31bd47b><!--[--><p class="text" data-v-e31bd47b>1.class-transformer</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5a346dfe data-v-669faec9><div class="VPDoc has-sidebar has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _xuxiaomo_guide_article_backend_nestjs_NestJS%E5%9F%BA%E7%A1%80_1_%E4%B9%9D%E5%A4%A7%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" data-v-6b87e69f><div><p>Nestjs的核心概念很多，如果是学过java的兄弟会比较熟悉，刚开始接触还是会有一些陌生，希望通过本文轻轻松松理解Nestjs的这些核心概念，先来整体看一下有哪些：</p><ul><li>Controllers</li><li>Providers</li><li>Modules</li><li>Middleware</li><li>Exception filters</li><li>Pipes</li><li>Guards</li><li>Interceptors</li><li>Custom decorators</li></ul><p>总共9个东西，要想全部掌握还是需要一定时间的，本文是个人学习笔记，也算是抛砖引玉，说的不到位的地方，大佬勿喷。</p><p>熟悉java的同学，对spring容器一定很熟悉，它可以用来管理对象，这些对象不用自己new出来，只需要加上类似@Controller的注解就会自动产生一个对象，全全由容器负责管理，这其实是一种单例模式的思想。</p><h2 id="一、controllers" tabindex="-1">一、Controllers <a class="header-anchor" href="#一、controllers" aria-label="Permalink to &quot;一、Controllers&quot;">​</a></h2><p>Controllers are responsible for handling incoming <strong>requests</strong> and returning <strong>responses</strong> to the client.</p><p>控制器是用来做路由导航的，控制着你的请求路径去往何方，比如<a href="http://xxx.com/user%EF%BC%8C%E5%8C%B9%E9%85%8D%E7%9A%84%E8%B7%AF%E5%BE%84%E6%98%AF/user%E3%80%82" target="_blank" rel="noreferrer">http://xxx.com/user，匹配的路径是/user。</a></p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/18ce1d3e647f41cda8e7402d0e730a93~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><ul><li>通过@Controller(...path...)来构造一个控制器，</li><li>在Module的中的@Module装饰器内放入控制器，@Module({controllers:[xxxController]})只有这样，Nest的Ioc容器才会产生出该控制器的实例，才能为你的application所用</li><li>常用的方法装饰器有@Get()、@Post()、@Patch()、@Delete()、等等</li><li>常用的方法参数装饰器有@Body()、@Query()、@Param()、@Request()/@Req()、@Response()/@Res()</li><li>@HttpCode()、@Header()、@Redirect()等这几个可能用的比较少，反正我目前基本不用</li></ul><h2 id="二、providers" tabindex="-1">二、Providers <a class="header-anchor" href="#二、providers" aria-label="Permalink to &quot;二、Providers&quot;">​</a></h2><p>Providers are a fundamental concept in Nest. Many of the basic Nest classes may be treated as a provider – services, repositories, factories, helpers, and so on. The main idea of a provider is that it can be <strong>injected</strong> as a dependency; this means objects can create various relationships with each other, and the function of &quot;wiring up&quot; instances of objects can largely be delegated to the Nest runtime system.</p><p>Providers是一个很基本的概念，很多Nest中定义的类可以被视为一个Provider，我理解的Provider其实就是可以为各个模块提供服务的，这个服务范围很广，例如可以是一个操作数据库某张表的Service，还可以是一个具体的值，这些服务可以被注入依赖体系，注入相关依赖后，可以在方使用。这个和java中的@Autowired()自动装配比较类似，但是也有很多不同，</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/54e7c70ff49b4f6ab8d4f9e45da03ef6~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>我们使用最多的还是类，下面主要以类来举例</p><h3 id="_1-最常用的服务就是类" tabindex="-1">1. 最常用的服务就是类！ <a class="header-anchor" href="#_1-最常用的服务就是类" aria-label="Permalink to &quot;1. 最常用的服务就是类！&quot;">​</a></h3><ul><li><strong>服务类使用@Injectable()装饰器装饰，表明该类可以由Nest的IoC容器管理</strong></li><li><strong>服务需要在对应的module中进行注册，如果不注册IoC容器是不会帮你创建对象的，而且还会报错</strong></li><li><strong>在其它类中使用时（如Controller控制器中），在该类的构造函数的参数中进行注入(后面也会讲通过属性注入的方法)</strong></li></ul><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bae2b388774d4b069a686bc7d9a85740~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>强调一下这里的依赖注入，可以看到是通过类构造函数来的， constructor(private readonly userService: UserService) {}，Nest提供了IoC容器利用Typescript自带类型的特点自动创建对象的能力，注意这里是单例模式，如果该Service在其它地方也被用过，那么会在不会重新创建对象，各个应用只会有一个该Service的对象，容器会先寻找当前有没有，如果没有再进行创建。</p><ul><li><strong>生命周期：默认情况下随着整个应用的启动而产生，随着应用的关闭而销毁，但是也可以自定义，可以随着请求的生命周期进行调整</strong></li></ul><h3 id="_2-自定义的provider" tabindex="-1">2. 自定义的provider <a class="header-anchor" href="#_2-自定义的provider" aria-label="Permalink to &quot;2. 自定义的provider&quot;">​</a></h3><p>就如刚开始将Provider的图示所描述的，provider可以是单纯地值，可以是类，可以一个工厂函数，其实上面类的写法是一种语法糖写法</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/df26a426f4364a439d393b7570543779~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>可以看出完整写法，通过给不同的provider标注不同的token，注入的时候使用@Inject(对应的token)进行注入</p><p>注意这里的provide属性，可以使用类名、strings、symbols或者enums，最佳实践中，一般把所有用到的token单独放到一个文件中，比如constants.ts，专门用来提供程序用到的所有token。</p><h4 id="usefactory" tabindex="-1">useFactory <a class="header-anchor" href="#usefactory" aria-label="Permalink to &quot;useFactory&quot;">​</a></h4><p>关于工厂函数useFactory，多说几句。它可以提供动态的provider，由factory函数的返回值来确定，factory函数可以很简单也可以很复杂，它也可以使用其它provider，不过需要注入，在inject属性进行注入，注入的provider可以是可选的</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">const connectionProvider = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  provide: &#39;CONNECTION&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  useFactory: (optionsProvider: OptionsProvider, optionalProvider?: string) =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const options = optionsProvider.get();</span></span>
<span class="line"><span style="color:#e1e4e8;">    return new DatabaseConnection(options);</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">  inject: [OptionsProvider, { token: &#39;SomeOptionalProvider&#39;, optional: true }],</span></span>
<span class="line"><span style="color:#e1e4e8;">  //       _____________/            __________________/</span></span>
<span class="line"><span style="color:#e1e4e8;">  //        This provider              The provider with this</span></span>
<span class="line"><span style="color:#e1e4e8;">  //        is mandatory.              token can resolve to `undefined`.</span></span>
<span class="line"><span style="color:#e1e4e8;">};</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    connectionProvider,</span></span>
<span class="line"><span style="color:#e1e4e8;">    OptionsProvider,</span></span>
<span class="line"><span style="color:#e1e4e8;">    // { provide: &#39;SomeOptionalProvider&#39;, useValue: &#39;anything&#39; },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">const connectionProvider = {</span></span>
<span class="line"><span style="color:#24292e;">  provide: &#39;CONNECTION&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  useFactory: (optionsProvider: OptionsProvider, optionalProvider?: string) =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const options = optionsProvider.get();</span></span>
<span class="line"><span style="color:#24292e;">    return new DatabaseConnection(options);</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">  inject: [OptionsProvider, { token: &#39;SomeOptionalProvider&#39;, optional: true }],</span></span>
<span class="line"><span style="color:#24292e;">  //       _____________/            __________________/</span></span>
<span class="line"><span style="color:#24292e;">  //        This provider              The provider with this</span></span>
<span class="line"><span style="color:#24292e;">  //        is mandatory.              token can resolve to `undefined`.</span></span>
<span class="line"><span style="color:#24292e;">};</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    connectionProvider,</span></span>
<span class="line"><span style="color:#24292e;">    OptionsProvider,</span></span>
<span class="line"><span style="color:#24292e;">    // { provide: &#39;SomeOptionalProvider&#39;, useValue: &#39;anything&#39; },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="useexisting" tabindex="-1">useExisting <a class="header-anchor" href="#useexisting" aria-label="Permalink to &quot;useExisting&quot;">​</a></h4><p>这其实只是一个别名的使用，相当于给同一个provider多个token，如下，当我们注入的时候@Inject(&#39;AliasedLoggerService&#39;)和@Inject(LoggerService)，最终使用的是同一个LoggerService的实例</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">class LoggerService {</span></span>
<span class="line"><span style="color:#e1e4e8;">  /* implementation details */</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">const loggerAliasProvider = {</span></span>
<span class="line"><span style="color:#e1e4e8;">  provide: &#39;AliasedLoggerService&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  useExisting: LoggerService,</span></span>
<span class="line"><span style="color:#e1e4e8;">};</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [LoggerService, loggerAliasProvider],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">class LoggerService {</span></span>
<span class="line"><span style="color:#24292e;">  /* implementation details */</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">const loggerAliasProvider = {</span></span>
<span class="line"><span style="color:#24292e;">  provide: &#39;AliasedLoggerService&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  useExisting: LoggerService,</span></span>
<span class="line"><span style="color:#24292e;">};</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [LoggerService, loggerAliasProvider],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>想了解更多关于自定义provider的知识，请移步官网：<a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank" rel="noreferrer">https://docs.nestjs.com/fundamentals/custom-providers</a></p><h3 id="_3-跨模块共享服务" tabindex="-1">3. 跨模块共享服务 <a class="header-anchor" href="#_3-跨模块共享服务" aria-label="Permalink to &quot;3. 跨模块共享服务&quot;">​</a></h3><p>provider具有自己的作用域，默认只在声明provider的模块内起效。如果要跨模块进行共享，前提是该服务要在在module中进行导出，也就是exports操作，exports可以填入完整的provider，也可以只填它的token(token后面会说)</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class UserModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其它模块想使用的话可以直接在module的imports中添加该模块或者在providers中添加该服务</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  // 方法一</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [UserModule],</span></span>
<span class="line"><span style="color:#e1e4e8;">  // 方法二</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  // 方法一</span></span>
<span class="line"><span style="color:#24292e;">  imports: [UserModule],</span></span>
<span class="line"><span style="color:#24292e;">  // 方法二</span></span>
<span class="line"><span style="color:#24292e;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class UserModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>或者也可以使用全局模块，为Module增加@Global()装饰器，比如我的数据库Orm的Module就作为了全局模块</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Global, Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { PrismaService } from &#39;./prisma.service&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Global()</span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [PrismaService],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [PrismaService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class PrismaModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Global, Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { PrismaService } from &#39;./prisma.service&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Global()</span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [PrismaService],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [PrismaService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class PrismaModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>当然，咱们所有的模块都需要在根模块AppModule中的imports引入进去</p><h3 id="_4-可选的provider" tabindex="-1">4.可选的provider <a class="header-anchor" href="#_4-可选的provider" aria-label="Permalink to &quot;4.可选的provider&quot;">​</a></h3><p>有些时候可能不需要实例化一个服务类，可能需要根据配置文件灵活处理，这时候可以给对应的注入服务再增加一个@Optional()装饰器就行</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">constructor(@Optional() @Inject(&#39;service&#39;) private service: xxxService) {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">constructor(@Optional() @Inject(&#39;service&#39;) private service: xxxService) {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_5-通过属性注入" tabindex="-1">5. 通过属性注入 <a class="header-anchor" href="#_5-通过属性注入" aria-label="Permalink to &quot;5. 通过属性注入&quot;">​</a></h3><p>这种注入方式用的极少，一种情况是你的顶级服务类class依赖了一个或多个providers，它的后代class将一直通过super()的方式进行构造，想想也还是比较可怕的。这时可以使用属性构造的方法：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, Inject } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class HttpService&lt;T&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Inject(&#39;HTTP_OPTIONS&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  private readonly httpClient: T;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, Inject } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class HttpService&lt;T&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  @Inject(&#39;HTTP_OPTIONS&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  private readonly httpClient: T;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果你的服务类没有继承自别的类，那请继续使用constructor构造函数来注入</p><h2 id="三、modules" tabindex="-1">三、Modules <a class="header-anchor" href="#三、modules" aria-label="Permalink to &quot;三、Modules&quot;">​</a></h2><p>A module is a class annotated with a @Module() decorator. The @Module() decorator provides metadata that <strong>Nest</strong> makes use of to organize the application structure.</p><p>可以看出，nestjs也是模块化编程的思想，一个应用由一个个拆分的模块来组成，每个模块负责自己的一部分业务，一个应用至少有一个模块，也就是根模块，使用@Module()装饰器来声明一个模块，模块也是一个类。</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ccda297aaf148a2818955d21233ff4c~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_1-module-装饰器" tabindex="-1">1. @Module()装饰器 <a class="header-anchor" href="#_1-module-装饰器" aria-label="Permalink to &quot;1. @Module()装饰器&quot;">​</a></h3><p>需要一个参数，是一个对象，里面包含四个属性，用来描述这个module，上面其实已经都讲到了</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [OtherModule],</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports:[UserService]</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [OtherModule],</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [UserController],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [UserService],</span></span>
<span class="line"><span style="color:#24292e;">  exports:[UserService]</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class UserModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>对于imports中导入的OtherModule，意味着OtherModule里exports的provider，可以在UserModule中使用</p><p>exports可以使用provider本身，亦可以使用provider的token</p><h3 id="_2-模块共享" tabindex="-1">2. 模块共享 <a class="header-anchor" href="#_2-模块共享" aria-label="Permalink to &quot;2. 模块共享&quot;">​</a></h3><p>在Provider中已经讲过了，就是通过exports导出相应的Service，在别的模块通过imports导入该模块</p><h3 id="_3-模块重导出" tabindex="-1">3. 模块重导出 <a class="header-anchor" href="#_3-模块重导出" aria-label="Permalink to &quot;3. 模块重导出&quot;">​</a></h3><p>这个感觉还是挺有用的，可以把一些常用的，公共的模块，全部先import进一个CommonModule，然后再把它们从exprots全部导出，以后如果有那个模块想要使用其中某个模块的Service，只需要将这个CommonModule导入即可，不用再导入所有的依赖模块</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CommonModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [Module1, Module2, Module3, Module4],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class CommonModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_4-模块类中也可以注入service" tabindex="-1">4. 模块类中也可以注入Service <a class="header-anchor" href="#_4-模块类中也可以注入service" aria-label="Permalink to &quot;4. 模块类中也可以注入Service&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { CatsController } from &#39;./cats.controller&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { CatsService } from &#39;./cats.service&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [CatsController],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [CatsService],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CatsModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private catsService: CatsService) {}</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Module } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { CatsController } from &#39;./cats.controller&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { CatsService } from &#39;./cats.service&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [CatsController],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [CatsService],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class CatsModule {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private catsService: CatsService) {}</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_5-全局模块global-modules" tabindex="-1">5. 全局模块Global modules <a class="header-anchor" href="#_5-全局模块global-modules" aria-label="Permalink to &quot;5. 全局模块Global modules&quot;">​</a></h3><p>通过@Global()装饰器声明一个全局模块，只需要在根模块imports注册该全局模块，就可以在其他所有模块内使用它导出的Service</p><h3 id="_6-动态模块dynamic-modules" tabindex="-1">6. 动态模块Dynamic modules <a class="header-anchor" href="#_6-动态模块dynamic-modules" aria-label="Permalink to &quot;6. 动态模块Dynamic modules&quot;">​</a></h3><p>这是nest提供的一个强大功能，可以让我们对模块进行定制化操作，自定义模块的注册，动态提供providers，看一下官方的示例</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Module, DynamicModule } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { createDatabaseProviders } from &#39;./database.providers&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Connection } from &#39;./connection.provider&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [Connection],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class DatabaseModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  static forRoot(entities = [], options?): DynamicModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const providers = createDatabaseProviders(options, entities);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return {</span></span>
<span class="line"><span style="color:#e1e4e8;">      module: DatabaseModule,</span></span>
<span class="line"><span style="color:#e1e4e8;">      providers: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">      exports: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">    };</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Module, DynamicModule } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { createDatabaseProviders } from &#39;./database.providers&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Connection } from &#39;./connection.provider&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [Connection],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class DatabaseModule {</span></span>
<span class="line"><span style="color:#24292e;">  static forRoot(entities = [], options?): DynamicModule {</span></span>
<span class="line"><span style="color:#24292e;">    const providers = createDatabaseProviders(options, entities);</span></span>
<span class="line"><span style="color:#24292e;">    return {</span></span>
<span class="line"><span style="color:#24292e;">      module: DatabaseModule,</span></span>
<span class="line"><span style="color:#24292e;">      providers: providers,</span></span>
<span class="line"><span style="color:#24292e;">      exports: providers,</span></span>
<span class="line"><span style="color:#24292e;">    };</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>原理其实很简单，就是给当前Module类提供一个forRoot方法，该方法返回一个新的Module，这个Module的类型是一个DynamicModule，在其他模块需要注册使用时，可以使用DatabaseModule.forRoot(参数)来动态的注册不同的Module，以达到提供不同providers的目的。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>如果想在全局作用域内注册一个动态Module，则在forRoot方法的返回值对象中加入global:true这个属性，当然一般情况下，nestjs其实不提倡搞全局模块的，我们按需使用就行。</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  global: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">  module: DatabaseModule,</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: providers,</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  global: true,</span></span>
<span class="line"><span style="color:#24292e;">  module: DatabaseModule,</span></span>
<span class="line"><span style="color:#24292e;">  providers: providers,</span></span>
<span class="line"><span style="color:#24292e;">  exports: providers,</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>动态模块的重导出可以省略forRoot()方法，如</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#e1e4e8;">  exports: [DatabaseModule],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [DatabaseModule.forRoot([User])],</span></span>
<span class="line"><span style="color:#24292e;">  exports: [DatabaseModule],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="四、middleware" tabindex="-1">四、Middleware <a class="header-anchor" href="#四、middleware" aria-label="Permalink to &quot;四、Middleware&quot;">​</a></h2><p>Middleware is a function which is called <strong>before</strong> the route handler. Middleware functions have access to the <a href="https://expressjs.com/en/4x/api.html#req" target="_blank" rel="noreferrer">request</a> and <a href="https://expressjs.com/en/4x/api.html#res" target="_blank" rel="noreferrer">response</a> objects, and the next() middleware function in the application’s request-response cycle. The <strong>next</strong> middleware function is commonly denoted by a variable named next.</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d15accfc9be34cf99a5fb542d4914792~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p><strong>中间件</strong>，学过Express和Koa的同学，对中间件这个概念应该很熟悉了。看官方说明，中间件可以拿到Request、Response对象及next函数，其实nest默认和express的中间件是等效的</p><p>再来回忆一下中间件的功能特性：</p><ul><li>可以执行任意的代码</li><li>对request和response对象进行改造</li><li>结束request-response循环</li><li>通过next()调用下一个中间件</li><li>如果当前中间件没有结束当前request-response循环，必须调用next()函数，否则请求会处于挂起状态，阻塞整个应用</li></ul><p>构造中间件的方式有两种，一种是通过函数，一种是通过类，下面看类的方式</p><h3 id="_1-创建类中间件" tabindex="-1">1. 创建类中间件 <a class="header-anchor" href="#_1-创建类中间件" aria-label="Permalink to &quot;1. 创建类中间件&quot;">​</a></h3><p>需要使用@Injectable()装饰器，类需要实现NestMiddleware接口(里面实现use方法)</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, NestMiddleware } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class LoggerMiddleware implements NestMiddleware {</span></span>
<span class="line"><span style="color:#e1e4e8;">  use(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;Request...&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    next();</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, NestMiddleware } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class LoggerMiddleware implements NestMiddleware {</span></span>
<span class="line"><span style="color:#24292e;">  use(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;Request...&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    next();</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_2-应用类中间件" tabindex="-1">2. 应用类中间件 <a class="header-anchor" href="#_2-应用类中间件" aria-label="Permalink to &quot;2. 应用类中间件&quot;">​</a></h3><p>我们知道@Module()装饰器内没有给middleware的配置，那么怎么办呢？这时候我们需要在module类中使用config进行加载，需要让module类实现NestModule接口，实现里面configure方法进行</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">  controllers: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure(consumer: MiddlewareConsumer): any {</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer.apply(LoggerMiddleware).forRoutes(&#39;&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [],</span></span>
<span class="line"><span style="color:#24292e;">  controllers: [],</span></span>
<span class="line"><span style="color:#24292e;">  providers: [],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  configure(consumer: MiddlewareConsumer): any {</span></span>
<span class="line"><span style="color:#24292e;">    consumer.apply(LoggerMiddleware).forRoutes(&#39;&#39;);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>apply方法表名要加载的是哪个中间件，forRootes方法表名对哪个请求路径起作用，这个和app.use(路径, 中间件)如出一辙，这里还可以对forRoutes进行更详细的配置，传入一个对象针对特定的某一个请求，path可以使用正则匹配？、+、<em>、()等，使用fastify驱动的需要注意不能使用</em>，如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#e1e4e8;">      .forRoutes({ path: &#39;ab*cd&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#24292e;">    consumer</span></span>
<span class="line"><span style="color:#24292e;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#24292e;">      .forRoutes({ path: &#39;ab*cd&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>注意，configure方法可以是异步的，如果里面有需要异步处理的操作，可以使用async/await来等待操作完成再往下进行</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  async configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    await ...</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#e1e4e8;">      .forRoutes({ path: &#39;cats&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  async configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#24292e;">    await ...</span></span>
<span class="line"><span style="color:#24292e;">    consumer</span></span>
<span class="line"><span style="color:#24292e;">      .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#24292e;">      .forRoutes({ path: &#39;cats&#39;, method: RequestMethod.GET });</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>默认情况下Nestjs应用使用express驱动，会使用body-parser来解析response的数据，如果你想自定义的话，需要在NestFactory.create()时将bodyParser置为false</p><h4 id="middlewareconsumer" tabindex="-1">MiddlewareConsumer <a class="header-anchor" href="#middlewareconsumer" aria-label="Permalink to &quot;MiddlewareConsumer&quot;">​</a></h4><ul><li>实现链式调用</li><li>apply可以放置多个middleware</li><li>forRoutes可以使用单个string路径，多个string路径，RouteInfo对象，单个Controller，多个Controller</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  imports: [],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#e1e4e8;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">      .apply(LoggerMiddleware, xxxMiddleware,...)</span></span>
<span class="line"><span style="color:#e1e4e8;">      .forRoutes(CatsController,UserController,...);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  imports: [],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule implements NestModule {</span></span>
<span class="line"><span style="color:#24292e;">  configure(consumer: MiddlewareConsumer) {</span></span>
<span class="line"><span style="color:#24292e;">    consumer</span></span>
<span class="line"><span style="color:#24292e;">      .apply(LoggerMiddleware, xxxMiddleware,...)</span></span>
<span class="line"><span style="color:#24292e;">      .forRoutes(CatsController,UserController,...);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>exclude可以排除不使用中间件的路径</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">  .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#e1e4e8;">  .exclude(</span></span>
<span class="line"><span style="color:#e1e4e8;">    { path: &#39;cats&#39;, method: RequestMethod.GET },</span></span>
<span class="line"><span style="color:#e1e4e8;">    { path: &#39;cats&#39;, method: RequestMethod.POST },</span></span>
<span class="line"><span style="color:#e1e4e8;">    &#39;cats/(.*)&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  )</span></span>
<span class="line"><span style="color:#e1e4e8;">  .forRoutes(CatsController);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">consumer</span></span>
<span class="line"><span style="color:#24292e;">  .apply(LoggerMiddleware)</span></span>
<span class="line"><span style="color:#24292e;">  .exclude(</span></span>
<span class="line"><span style="color:#24292e;">    { path: &#39;cats&#39;, method: RequestMethod.GET },</span></span>
<span class="line"><span style="color:#24292e;">    { path: &#39;cats&#39;, method: RequestMethod.POST },</span></span>
<span class="line"><span style="color:#24292e;">    &#39;cats/(.*)&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  )</span></span>
<span class="line"><span style="color:#24292e;">  .forRoutes(CatsController);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_3-函数式中间件" tabindex="-1">3. 函数式中间件 <a class="header-anchor" href="#_3-函数式中间件" aria-label="Permalink to &quot;3. 函数式中间件&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export function logger(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(`Request...`);</span></span>
<span class="line"><span style="color:#e1e4e8;">  next</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Request, Response, NextFunction } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export function logger(req: Request, res: Response, next: NextFunction) {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(`Request...`);</span></span>
<span class="line"><span style="color:#24292e;">  next</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>使用</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">consumer</span></span>
<span class="line"><span style="color:#e1e4e8;">  .apply(logger)</span></span>
<span class="line"><span style="color:#e1e4e8;">  .forRoutes(CatsController);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">consumer</span></span>
<span class="line"><span style="color:#24292e;">  .apply(logger)</span></span>
<span class="line"><span style="color:#24292e;">  .forRoutes(CatsController);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果你的中间件不需要依赖其它东西时，可以尽可能使用函数式中间件，较为简单</p><h3 id="_4-全局中间件" tabindex="-1">4. 全局中间件 <a class="header-anchor" href="#_4-全局中间件" aria-label="Permalink to &quot;4. 全局中间件&quot;">​</a></h3><p>在main.ts中直接使用app.use(中间件)</p><p>如经常添加的解决跨域的中间件(下面还自定义了logger日志系统，后面抽空再单独出一篇关于日志的)</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  // 使用自定义winston日志</span></span>
<span class="line"><span style="color:#e1e4e8;">  const app = await NestFactory.create&lt;NestExpressApplication&gt;(AppModule, {</span></span>
<span class="line"><span style="color:#e1e4e8;">    logger: WinstonModule.createLogger({</span></span>
<span class="line"><span style="color:#e1e4e8;">      instance: logInstance,</span></span>
<span class="line"><span style="color:#e1e4e8;">    }),</span></span>
<span class="line"><span style="color:#e1e4e8;">  });</span></span>
<span class="line"><span style="color:#e1e4e8;">  // 跨域设置</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.use(cors());</span></span>
<span class="line"><span style="color:#e1e4e8;">  await app.listen(7777);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#24292e;">  // 使用自定义winston日志</span></span>
<span class="line"><span style="color:#24292e;">  const app = await NestFactory.create&lt;NestExpressApplication&gt;(AppModule, {</span></span>
<span class="line"><span style="color:#24292e;">    logger: WinstonModule.createLogger({</span></span>
<span class="line"><span style="color:#24292e;">      instance: logInstance,</span></span>
<span class="line"><span style="color:#24292e;">    }),</span></span>
<span class="line"><span style="color:#24292e;">  });</span></span>
<span class="line"><span style="color:#24292e;">  // 跨域设置</span></span>
<span class="line"><span style="color:#24292e;">  app.use(cors());</span></span>
<span class="line"><span style="color:#24292e;">  await app.listen(7777);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">bootstrap();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="五、exception-filters" tabindex="-1">五、Exception filters <a class="header-anchor" href="#五、exception-filters" aria-label="Permalink to &quot;五、Exception filters&quot;">​</a></h2><p>Nest comes with a built-in <strong>exceptions layer</strong> which is responsible for processing all unhandled exceptions across an application. When an exception is not handled by your application code, it is caught by this layer, which then automatically sends an appropriate user-friendly response.</p><p>nest内置了一个异常处理层，如果我们没有手动处理异常，所有的异常都会进到这里，系统将给出响应的提示信息。</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5a6de167abec43d7bb8c1be759105d64~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>如果没有手动做处理，发生异常时，response返回给前端的信息将是如下形式：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;statusCode&quot;: 500,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;message&quot;: &quot;Internal server error&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;statusCode&quot;: 500,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;message&quot;: &quot;Internal server error&quot;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-抛出标准异常" tabindex="-1">1. 抛出标准异常 <a class="header-anchor" href="#_1-抛出标准异常" aria-label="Permalink to &quot;1. 抛出标准异常&quot;">​</a></h3><p>nest内置了HttpException，可以直接抛出该异常</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get()</span></span>
<span class="line"><span style="color:#e1e4e8;">async findAll() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  throw new HttpException(&#39;Forbidden&#39;, HttpStatus.FORBIDDEN);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get()</span></span>
<span class="line"><span style="color:#24292e;">async findAll() {</span></span>
<span class="line"><span style="color:#24292e;">  throw new HttpException(&#39;Forbidden&#39;, HttpStatus.FORBIDDEN);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>客户端请求的得到的结果如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;statusCode&quot;: 403,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;message&quot;: &quot;Forbidden&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;statusCode&quot;: 403,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;message&quot;: &quot;Forbidden&quot;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3920f483b8d740f68e452918e2435dca~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>关于参数：</p><ul><li>第1个参数是response，定义了返回给前端的response body，可以是一个字符串，也可以是一个对象</li><li>第2个参数是status，定义了HTTP的状态码，一般使用枚举来赋值，如HttpStatus.FORBIDDEN</li><li>第3个参数是可选的额外配置参数，提供一个cause属性，接收错误，在日志记录方面比较有用</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">getHello(@Request() req) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  throw new HttpException(</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#e1e4e8;">      error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">    HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      cause: new Error(&#39;实际的错误信息&#39;),</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  );</span></span>
<span class="line"><span style="color:#e1e4e8;">  return req.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">getHello(@Request() req) {</span></span>
<span class="line"><span style="color:#24292e;">  throw new HttpException(</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#24292e;">      error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#24292e;">      custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">    HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      cause: new Error(&#39;实际的错误信息&#39;),</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  );</span></span>
<span class="line"><span style="color:#24292e;">  return req.user;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>请求返回值将变成：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#e1e4e8;">  error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">},</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  status: HttpStatus.EXPECTATION_FAILED,</span></span>
<span class="line"><span style="color:#24292e;">  error: &#39;this is a error msg&#39;,</span></span>
<span class="line"><span style="color:#24292e;">  custom: &#39;this is a custom res&#39;,</span></span>
<span class="line"><span style="color:#24292e;">},</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-自定义异常" tabindex="-1">2. 自定义异常 <a class="header-anchor" href="#_2-自定义异常" aria-label="Permalink to &quot;2. 自定义异常&quot;">​</a></h3><p>我们可以创建一个类继承HttpException，在里面进行一些自定义配置，然后使用的时候直接throw xxxException</p><p>官网给我们内置了很多HttpException的子类，可以直接抛出。详见官网<a href="https://docs.nestjs.com/exception-filters" target="_blank" rel="noreferrer">https://docs.nestjs.com/exception-filters</a></p><p>如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;"> new BadRequestException(&#39;Something bad happened&#39;, { cause: new Error(), description: &#39;Some error description&#39; })</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;"> new BadRequestException(&#39;Something bad happened&#39;, { cause: new Error(), description: &#39;Some error description&#39; })</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>返回结果如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">{</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;message&quot;: &quot;Something bad happened&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;error&quot;: &quot;Some error description&quot;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  &quot;statusCode&quot;: 400,</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">{</span></span>
<span class="line"><span style="color:#24292e;">  &quot;message&quot;: &quot;Something bad happened&quot;,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;error&quot;: &quot;Some error description&quot;,</span></span>
<span class="line"><span style="color:#24292e;">  &quot;statusCode&quot;: 400,</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>这里再提示一下：如果response参数只是一个字符串，那返回体将会把status作为statusCode属性的值，会把options里的description作为error属性的值，如果response参数是一个对象，那返回体就只有这个对象里的属性</strong></p><h3 id="_3-异常过滤器exception-filters" tabindex="-1">3. 异常过滤器Exception filters <a class="header-anchor" href="#_3-异常过滤器exception-filters" aria-label="Permalink to &quot;3. 异常过滤器Exception filters&quot;">​</a></h3><p>如果想要更加个性化的定制Exception返回数据格式，可以使用Exception filters，下面是我自定义的HttpExceptionFilter，它需要实现ExceptionFilter接口，实现里面catch方法，并使用@Catch()装饰器进行修饰，它接收一个或多个参数，表明要捕获哪些异常.</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import {</span></span>
<span class="line"><span style="color:#e1e4e8;">  Catch,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#e1e4e8;">  HttpException,</span></span>
<span class="line"><span style="color:#e1e4e8;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Request, Response } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Catch(HttpException)</span></span>
<span class="line"><span style="color:#e1e4e8;">export class httpExceptionFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#e1e4e8;">  catch(exception: HttpException, host: ArgumentsHost): any {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 拿到ctx对象</span></span>
<span class="line"><span style="color:#e1e4e8;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = ctx.getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const response = ctx.getResponse&lt;Response&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const status = exception.getStatus();</span></span>
<span class="line"><span style="color:#e1e4e8;">    response.status(status).json({</span></span>
<span class="line"><span style="color:#e1e4e8;">      code: status,</span></span>
<span class="line"><span style="color:#e1e4e8;">      success: false,</span></span>
<span class="line"><span style="color:#e1e4e8;">      data: {</span></span>
<span class="line"><span style="color:#e1e4e8;">        requestQuery: request.query,</span></span>
<span class="line"><span style="color:#e1e4e8;">        requestParam: request.params,</span></span>
<span class="line"><span style="color:#e1e4e8;">        requestBody: request.body,</span></span>
<span class="line"><span style="color:#e1e4e8;">      },</span></span>
<span class="line"><span style="color:#e1e4e8;">      time: new Date().getTime(),</span></span>
<span class="line"><span style="color:#e1e4e8;">      url: request.url,</span></span>
<span class="line"><span style="color:#e1e4e8;">    });</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import {</span></span>
<span class="line"><span style="color:#24292e;">  Catch,</span></span>
<span class="line"><span style="color:#24292e;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#24292e;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#24292e;">  HttpException,</span></span>
<span class="line"><span style="color:#24292e;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Request, Response } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Catch(HttpException)</span></span>
<span class="line"><span style="color:#24292e;">export class httpExceptionFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#24292e;">  catch(exception: HttpException, host: ArgumentsHost): any {</span></span>
<span class="line"><span style="color:#24292e;">    // 拿到ctx对象</span></span>
<span class="line"><span style="color:#24292e;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#24292e;">    const request = ctx.getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    const response = ctx.getResponse&lt;Response&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    const status = exception.getStatus();</span></span>
<span class="line"><span style="color:#24292e;">    response.status(status).json({</span></span>
<span class="line"><span style="color:#24292e;">      code: status,</span></span>
<span class="line"><span style="color:#24292e;">      success: false,</span></span>
<span class="line"><span style="color:#24292e;">      data: {</span></span>
<span class="line"><span style="color:#24292e;">        requestQuery: request.query,</span></span>
<span class="line"><span style="color:#24292e;">        requestParam: request.params,</span></span>
<span class="line"><span style="color:#24292e;">        requestBody: request.body,</span></span>
<span class="line"><span style="color:#24292e;">      },</span></span>
<span class="line"><span style="color:#24292e;">      time: new Date().getTime(),</span></span>
<span class="line"><span style="color:#24292e;">      url: request.url,</span></span>
<span class="line"><span style="color:#24292e;">    });</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>catch()方法的两个参数，其中host参数的类型为ArgumentHost，可以通过它拿到Request和Response对象，从而进行相应的操作。ArgumentHost是一个很丰富很复杂的接口，可以简单看一下它的定义，可以针对不同的请求协议拿到不同的host，这个以后有机会再研究。有兴趣的可以移步官网查看：<a href="https://docs.nestjs.com/fundamentals/execution-context" target="_blank" rel="noreferrer">https://docs.nestjs.com/fundamentals/execution-context</a></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/**</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Provides methods for retrieving the arguments being passed to a handler.</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Allows choosing the appropriate execution context (e.g., Http, RPC, or</span></span>
<span class="line"><span style="color:#e1e4e8;"> * WebSockets) to retrieve the arguments from.</span></span>
<span class="line"><span style="color:#e1e4e8;"> *</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @publicApi</span></span>
<span class="line"><span style="color:#e1e4e8;"> */</span></span>
<span class="line"><span style="color:#e1e4e8;">export interface ArgumentsHost {</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns the array of arguments being passed to the handler.</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    getArgs&lt;T extends Array&lt;any&gt; = any[]&gt;(): T;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns a particular argument by index.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @param index index of argument to retrieve</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    getArgByIndex&lt;T = any&gt;(index: number): T;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Switch context to RPC.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @returns interface with methods to retrieve RPC arguments</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    switchToRpc(): RpcArgumentsHost;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Switch context to HTTP.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @returns interface with methods to retrieve HTTP arguments</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    switchToHttp(): HttpArgumentsHost;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Switch context to WebSockets.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @returns interface with methods to retrieve WebSockets arguments</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    switchToWs(): WsArgumentsHost;</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns the current execution context type (string)</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    getType&lt;TContext extends string = ContextType&gt;(): TContext;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/**</span></span>
<span class="line"><span style="color:#24292e;"> * Provides methods for retrieving the arguments being passed to a handler.</span></span>
<span class="line"><span style="color:#24292e;"> * Allows choosing the appropriate execution context (e.g., Http, RPC, or</span></span>
<span class="line"><span style="color:#24292e;"> * WebSockets) to retrieve the arguments from.</span></span>
<span class="line"><span style="color:#24292e;"> *</span></span>
<span class="line"><span style="color:#24292e;"> * @publicApi</span></span>
<span class="line"><span style="color:#24292e;"> */</span></span>
<span class="line"><span style="color:#24292e;">export interface ArgumentsHost {</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns the array of arguments being passed to the handler.</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    getArgs&lt;T extends Array&lt;any&gt; = any[]&gt;(): T;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns a particular argument by index.</span></span>
<span class="line"><span style="color:#24292e;">     * @param index index of argument to retrieve</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    getArgByIndex&lt;T = any&gt;(index: number): T;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Switch context to RPC.</span></span>
<span class="line"><span style="color:#24292e;">     * @returns interface with methods to retrieve RPC arguments</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    switchToRpc(): RpcArgumentsHost;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Switch context to HTTP.</span></span>
<span class="line"><span style="color:#24292e;">     * @returns interface with methods to retrieve HTTP arguments</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    switchToHttp(): HttpArgumentsHost;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Switch context to WebSockets.</span></span>
<span class="line"><span style="color:#24292e;">     * @returns interface with methods to retrieve WebSockets arguments</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    switchToWs(): WsArgumentsHost;</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns the current execution context type (string)</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    getType&lt;TContext extends string = ContextType&gt;(): TContext;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="_4-使用filters" tabindex="-1">4. 使用filters <a class="header-anchor" href="#_4-使用filters" aria-label="Permalink to &quot;4. 使用filters&quot;">​</a></h3><h4 id="_1方法作用域" tabindex="-1">①方法作用域 <a class="header-anchor" href="#_1方法作用域" aria-label="Permalink to &quot;①方法作用域&quot;">​</a></h4><p>可以绑定到具体的方法上，使用@UseFilters(new HttpExceptionFilter())装饰器，可以传多个filter，<strong>亦可以使用类名作为参数，创建实例的事就交给nest框架帮我们处理，尽可能使用类作为参数，可以减小内存开支，因为全局公用一个实例instance</strong></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Post()</span></span>
<span class="line"><span style="color:#e1e4e8;">@UseFilters(HttpExceptionFilter)</span></span>
<span class="line"><span style="color:#e1e4e8;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  throw new ForbiddenException();</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Post()</span></span>
<span class="line"><span style="color:#24292e;">@UseFilters(HttpExceptionFilter)</span></span>
<span class="line"><span style="color:#24292e;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#24292e;">  throw new ForbiddenException();</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2controller作用域" tabindex="-1">②Controller作用域 <a class="header-anchor" href="#_2controller作用域" aria-label="Permalink to &quot;②Controller作用域&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@UseFilters(new HttpExceptionFilter())</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CatsController {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@UseFilters(new HttpExceptionFilter())</span></span>
<span class="line"><span style="color:#24292e;">export class CatsController {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_3全局作用域" tabindex="-1">③全局作用域 <a class="header-anchor" href="#_3全局作用域" aria-label="Permalink to &quot;③全局作用域&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.useGlobalFilters(new HttpExceptionFilter());</span></span>
<span class="line"><span style="color:#e1e4e8;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#24292e;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#24292e;">  app.useGlobalFilters(new HttpExceptionFilter());</span></span>
<span class="line"><span style="color:#24292e;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">bootstrap();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>我试验了一下，全局使用时不能使用类作为useGlobalFilters的参数</p><p>注意：当使用全局模式的时候，如果想用依赖注入的方式，必须使用特定的方式，在任意一个模块下使用如下方法：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      provide: APP_FILTER,</span></span>
<span class="line"><span style="color:#e1e4e8;">      useClass: HttpExceptionFilter,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      provide: APP_FILTER,</span></span>
<span class="line"><span style="color:#24292e;">      useClass: HttpExceptionFilter,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>这跟后面要将的全局Guard类似</p><h3 id="_5-捕获所有异常" tabindex="-1">5. 捕获所有异常 <a class="header-anchor" href="#_5-捕获所有异常" aria-label="Permalink to &quot;5. 捕获所有异常&quot;">​</a></h3><p>@Catch()的参数列表为空时修饰的filter就是一个能捕获所有异常的filter，贴出官网的示例代码</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import {</span></span>
<span class="line"><span style="color:#e1e4e8;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#e1e4e8;">  Catch,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#e1e4e8;">  HttpException,</span></span>
<span class="line"><span style="color:#e1e4e8;">  HttpStatus,</span></span>
<span class="line"><span style="color:#e1e4e8;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { HttpAdapterHost } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Catch()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AllExceptionsFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private readonly httpAdapterHost: HttpAdapterHost) {}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  catch(exception: unknown, host: ArgumentsHost): void {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // In certain situations `httpAdapter` might not be available in the</span></span>
<span class="line"><span style="color:#e1e4e8;">    // constructor method, thus we should resolve it here.</span></span>
<span class="line"><span style="color:#e1e4e8;">    const { httpAdapter } = this.httpAdapterHost;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    const httpStatus =</span></span>
<span class="line"><span style="color:#e1e4e8;">      exception instanceof HttpException</span></span>
<span class="line"><span style="color:#e1e4e8;">        ? exception.getStatus()</span></span>
<span class="line"><span style="color:#e1e4e8;">        : HttpStatus.INTERNAL_SERVER_ERROR;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    const responseBody = {</span></span>
<span class="line"><span style="color:#e1e4e8;">      statusCode: httpStatus,</span></span>
<span class="line"><span style="color:#e1e4e8;">      timestamp: new Date().toISOString(),</span></span>
<span class="line"><span style="color:#e1e4e8;">      path: httpAdapter.getRequestUrl(ctx.getRequest()),</span></span>
<span class="line"><span style="color:#e1e4e8;">    };</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    httpAdapter.reply(ctx.getResponse(), responseBody, httpStatus);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import {</span></span>
<span class="line"><span style="color:#24292e;">  ExceptionFilter,</span></span>
<span class="line"><span style="color:#24292e;">  Catch,</span></span>
<span class="line"><span style="color:#24292e;">  ArgumentsHost,</span></span>
<span class="line"><span style="color:#24292e;">  HttpException,</span></span>
<span class="line"><span style="color:#24292e;">  HttpStatus,</span></span>
<span class="line"><span style="color:#24292e;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { HttpAdapterHost } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Catch()</span></span>
<span class="line"><span style="color:#24292e;">export class AllExceptionsFilter implements ExceptionFilter {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private readonly httpAdapterHost: HttpAdapterHost) {}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  catch(exception: unknown, host: ArgumentsHost): void {</span></span>
<span class="line"><span style="color:#24292e;">    // In certain situations `httpAdapter` might not be available in the</span></span>
<span class="line"><span style="color:#24292e;">    // constructor method, thus we should resolve it here.</span></span>
<span class="line"><span style="color:#24292e;">    const { httpAdapter } = this.httpAdapterHost;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    const ctx = host.switchToHttp();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    const httpStatus =</span></span>
<span class="line"><span style="color:#24292e;">      exception instanceof HttpException</span></span>
<span class="line"><span style="color:#24292e;">        ? exception.getStatus()</span></span>
<span class="line"><span style="color:#24292e;">        : HttpStatus.INTERNAL_SERVER_ERROR;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    const responseBody = {</span></span>
<span class="line"><span style="color:#24292e;">      statusCode: httpStatus,</span></span>
<span class="line"><span style="color:#24292e;">      timestamp: new Date().toISOString(),</span></span>
<span class="line"><span style="color:#24292e;">      path: httpAdapter.getRequestUrl(ctx.getRequest()),</span></span>
<span class="line"><span style="color:#24292e;">    };</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    httpAdapter.reply(ctx.getResponse(), responseBody, httpStatus);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>使用的时候，可以给构造器传入一个httpAdapter参数</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#e1e4e8;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  const { httpAdapter } = app.get(HttpAdapterHost);</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.useGlobalFilters(new AllExceptionsFilter(httpAdapter));</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">bootstrap();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">async function bootstrap() {</span></span>
<span class="line"><span style="color:#24292e;">  const app = await NestFactory.create(AppModule);</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  const { httpAdapter } = app.get(HttpAdapterHost);</span></span>
<span class="line"><span style="color:#24292e;">  app.useGlobalFilters(new AllExceptionsFilter(httpAdapter));</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  await app.listen(3000);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">bootstrap();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_6-继承baseexceptionfilter" tabindex="-1">6.继承BaseExceptionFilter <a class="header-anchor" href="#_6-继承baseexceptionfilter" aria-label="Permalink to &quot;6.继承BaseExceptionFilter&quot;">​</a></h3><p>用于修改默认的内置全局异常，对于这种异常类，如果作用于方法或者Controller，则UseFilters()的参数只能使用类，让nest帮我们做剩下的事</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Catch, ArgumentsHost } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { BaseExceptionFilter } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Catch()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AllExceptionsFilter extends BaseExceptionFilter {</span></span>
<span class="line"><span style="color:#e1e4e8;">  catch(exception: unknown, host: ArgumentsHost) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    //....处理相关逻辑</span></span>
<span class="line"><span style="color:#e1e4e8;">    super.catch(exception, host);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Catch, ArgumentsHost } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { BaseExceptionFilter } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Catch()</span></span>
<span class="line"><span style="color:#24292e;">export class AllExceptionsFilter extends BaseExceptionFilter {</span></span>
<span class="line"><span style="color:#24292e;">  catch(exception: unknown, host: ArgumentsHost) {</span></span>
<span class="line"><span style="color:#24292e;">    //....处理相关逻辑</span></span>
<span class="line"><span style="color:#24292e;">    super.catch(exception, host);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>第5点和第6点其实都是全局异常，看你的业务进行相应的选择</p><h2 id="六、pipes" tabindex="-1">六、Pipes <a class="header-anchor" href="#六、pipes" aria-label="Permalink to &quot;六、Pipes&quot;">​</a></h2><p>A pipe is a class annotated with the @Injectable() decorator, which implements the PipeTransform interface.</p><p>管道也是一个类，使用装饰器@Injectable()，并实现接口PipeTransform</p><p>管道有两个典型的应用场景</p><ul><li>transformation：数据转换，如将请求的输入数据从string转为integer</li><li>validation：对请求的输入数据进行验证，验证不通过抛出异常，这一部分其实感觉也可以让前台来做</li></ul><p>以上两种场景下，管道都是对Controller控制器中的handler处理函数的参数进行操作，这个操作发生在handler函数真正执行之前，如果在pipes中抛出异常，会直接跳到异常处理，并返回前端，Controller下的处理函数压根不会执行，这也算是一种应用保护机制。</p><ul><li>如果是做validation，那么要么验证通过返回没有经过修改的value，要么验证失败，抛出错误</li><li>如果是transformation：那么转换为想要的类型，如果转换失败则抛出异常</li></ul><h3 id="_1-内置pipes" tabindex="-1">1. 内置pipes <a class="header-anchor" href="#_1-内置pipes" aria-label="Permalink to &quot;1. 内置pipes&quot;">​</a></h3><ul><li>ValidationPipe</li><li>ParseIntPipe</li><li>ParseFloatPipe</li><li>ParseBoolPipe</li><li>ParseArrayPipe</li><li>ParseUUIDPipe</li><li>ParseEnumPipe</li><li>DefaultValuePipe</li><li>ParseFilePipe</li></ul><h4 id="parse-pipe系列" tabindex="-1">Parse*Pipe系列 <a class="header-anchor" href="#parse-pipe系列" aria-label="Permalink to &quot;Parse*Pipe系列&quot;">​</a></h4><ul><li>使用类</li></ul><p>这一系列都是转换数据用的，可以在Controller的handler方法参数上使用，如下直接给@Param()提供第二个参数，用于转换，这里提供一个类，nest会自动将其实力为一个对象</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;hello/:id&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">getHello(@Param(&#39;id&#39;, ParseIntPipe) id: number, @Request() req) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(typeof id);</span></span>
<span class="line"><span style="color:#e1e4e8;">  return req.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;hello/:id&#39;)</span></span>
<span class="line"><span style="color:#24292e;">getHello(@Param(&#39;id&#39;, ParseIntPipe) id: number, @Request() req) {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(typeof id);</span></span>
<span class="line"><span style="color:#24292e;">  return req.user;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>到请求为/hello/123时正常返回</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e9af5dd2dd14461b9e0724958b0cb60~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>当请求为/hello/123a时，转换出错，抛出异常</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdc65119443b4ea4895ac3073477b878~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><ul><li>使用自定义的实例</li></ul><p>如下自定义statuscode</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">  getHello(</span></span>
<span class="line"><span style="color:#e1e4e8;">    @Param(</span></span>
<span class="line"><span style="color:#e1e4e8;">      &#39;id&#39;,</span></span>
<span class="line"><span style="color:#e1e4e8;">      new ParseIntPipe({</span></span>
<span class="line"><span style="color:#e1e4e8;">        errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE,</span></span>
<span class="line"><span style="color:#e1e4e8;">      }),</span></span>
<span class="line"><span style="color:#e1e4e8;">    )</span></span>
<span class="line"><span style="color:#e1e4e8;">    id: number,</span></span>
<span class="line"><span style="color:#e1e4e8;">    @Request() req,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(typeof id);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return req.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">  getHello(</span></span>
<span class="line"><span style="color:#24292e;">    @Param(</span></span>
<span class="line"><span style="color:#24292e;">      &#39;id&#39;,</span></span>
<span class="line"><span style="color:#24292e;">      new ParseIntPipe({</span></span>
<span class="line"><span style="color:#24292e;">        errorHttpStatusCode: HttpStatus.NOT_ACCEPTABLE,</span></span>
<span class="line"><span style="color:#24292e;">      }),</span></span>
<span class="line"><span style="color:#24292e;">    )</span></span>
<span class="line"><span style="color:#24292e;">    id: number,</span></span>
<span class="line"><span style="color:#24292e;">    @Request() req,</span></span>
<span class="line"><span style="color:#24292e;">  ) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(typeof id);</span></span>
<span class="line"><span style="color:#24292e;">    return req.user;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/01df501b269d44e1b92f2501e686938e~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_2-自定义pipes-validation为例" tabindex="-1">2. 自定义Pipes(validation为例) <a class="header-anchor" href="#_2-自定义pipes-validation为例" aria-label="Permalink to &quot;2. 自定义Pipes(validation为例)&quot;">​</a></h3><p>不论是transformation还是validation都需要使用@Injectable()装饰器，并实现PipeTransform接口，基本实现如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CustomValidationPipe implements PipeTransform {</span></span>
<span class="line"><span style="color:#e1e4e8;">  transform(value: any, metadata: ArgumentMetadata): any {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class CustomValidationPipe implements PipeTransform {</span></span>
<span class="line"><span style="color:#24292e;">  transform(value: any, metadata: ArgumentMetadata): any {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#24292e;">    return value;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>其中value就是被CustomValidationPipe修饰的参数，metadata是该参数的meta属性，它类型如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export interface ArgumentMetadata {</span></span>
<span class="line"><span style="color:#e1e4e8;">  type: &#39;body&#39; | &#39;query&#39; | &#39;param&#39; | &#39;custom&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">  metatype?: Type&lt;unknown&gt;;</span></span>
<span class="line"><span style="color:#e1e4e8;">  data?: string;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export interface ArgumentMetadata {</span></span>
<span class="line"><span style="color:#24292e;">  type: &#39;body&#39; | &#39;query&#39; | &#39;param&#39; | &#39;custom&#39;;</span></span>
<span class="line"><span style="color:#24292e;">  metatype?: Type&lt;unknown&gt;;</span></span>
<span class="line"><span style="color:#24292e;">  data?: string;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="使用class-validator" tabindex="-1">使用class validator <a class="header-anchor" href="#使用class-validator" aria-label="Permalink to &quot;使用class validator&quot;">​</a></h5><p>官网上讲了好几种不同实现，我们主要看class validator，依托于class-validator和class-transformer，先安装依赖</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">$ npm i --save class-validator class-transformer</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">$ npm i --save class-validator class-transformer</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>对于我们新建用户来说，要校验创建用户的信息，对创建用户的Dto类使用class-validator的各种验证装饰器</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { IsOptional, IsString } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export class CreateUserDto {</span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsString()</span></span>
<span class="line"><span style="color:#e1e4e8;">  username: string;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsString()</span></span>
<span class="line"><span style="color:#e1e4e8;">  password: string;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsString()</span></span>
<span class="line"><span style="color:#e1e4e8;">  @IsOptional()</span></span>
<span class="line"><span style="color:#e1e4e8;">  role?: string;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { IsOptional, IsString } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export class CreateUserDto {</span></span>
<span class="line"><span style="color:#24292e;">  @IsString()</span></span>
<span class="line"><span style="color:#24292e;">  username: string;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  @IsString()</span></span>
<span class="line"><span style="color:#24292e;">  password: string;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  @IsString()</span></span>
<span class="line"><span style="color:#24292e;">  @IsOptional()</span></span>
<span class="line"><span style="color:#24292e;">  role?: string;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>编写validation-pipes类</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import {</span></span>
<span class="line"><span style="color:#e1e4e8;">  ArgumentMetadata,</span></span>
<span class="line"><span style="color:#e1e4e8;">  BadRequestException,</span></span>
<span class="line"><span style="color:#e1e4e8;">  Injectable,</span></span>
<span class="line"><span style="color:#e1e4e8;">  PipeTransform,</span></span>
<span class="line"><span style="color:#e1e4e8;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { validate } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { plainToInstance } from &#39;class-transformer&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class CustomValidationPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  async transform(value: any, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#e1e4e8;">    const { metatype } = metadata;</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 判断传入的参数有没有类型，如果没有相当于是原生的js，则不做校验</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 这里的类型指的就是Controller中的参数有没有指定类型，只有制定了类型的参数才需要校验</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (!metatype || !this.toValidate(metatype)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 获取带有类型的obj对象</span></span>
<span class="line"><span style="color:#e1e4e8;">    const object = plainToInstance(metatype, value);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 校验</span></span>
<span class="line"><span style="color:#e1e4e8;">    const errors = await validate(object);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 如果校验出错，抛出异常</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (errors.length &gt; 0) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 如果校验通过返回value unchanged</span></span>
<span class="line"><span style="color:#e1e4e8;">    return value;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  private toValidate(metatype: Function): boolean {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const types: Function[] = [String, Boolean, Number, Array, Object];</span></span>
<span class="line"><span style="color:#e1e4e8;">    return !types.includes(metatype);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import {</span></span>
<span class="line"><span style="color:#24292e;">  ArgumentMetadata,</span></span>
<span class="line"><span style="color:#24292e;">  BadRequestException,</span></span>
<span class="line"><span style="color:#24292e;">  Injectable,</span></span>
<span class="line"><span style="color:#24292e;">  PipeTransform,</span></span>
<span class="line"><span style="color:#24292e;">} from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { validate } from &#39;class-validator&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { plainToInstance } from &#39;class-transformer&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class CustomValidationPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  async transform(value: any, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-value====&#39;, value);</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;====custom-pipe-metadata====&#39;, metadata);</span></span>
<span class="line"><span style="color:#24292e;">    const { metatype } = metadata;</span></span>
<span class="line"><span style="color:#24292e;">    // 判断传入的参数有没有类型，如果没有相当于是原生的js，则不做校验</span></span>
<span class="line"><span style="color:#24292e;">    // 这里的类型指的就是Controller中的参数有没有指定类型，只有制定了类型的参数才需要校验</span></span>
<span class="line"><span style="color:#24292e;">    if (!metatype || !this.toValidate(metatype)) {</span></span>
<span class="line"><span style="color:#24292e;">      return value;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    // 获取带有类型的obj对象</span></span>
<span class="line"><span style="color:#24292e;">    const object = plainToInstance(metatype, value);</span></span>
<span class="line"><span style="color:#24292e;">    // 校验</span></span>
<span class="line"><span style="color:#24292e;">    const errors = await validate(object);</span></span>
<span class="line"><span style="color:#24292e;">    // 如果校验出错，抛出异常</span></span>
<span class="line"><span style="color:#24292e;">    if (errors.length &gt; 0) {</span></span>
<span class="line"><span style="color:#24292e;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    // 如果校验通过返回value unchanged</span></span>
<span class="line"><span style="color:#24292e;">    return value;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  private toValidate(metatype: Function): boolean {</span></span>
<span class="line"><span style="color:#24292e;">    const types: Function[] = [String, Boolean, Number, Array, Object];</span></span>
<span class="line"><span style="color:#24292e;">    return !types.includes(metatype);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>使用：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">  @Post()</span></span>
<span class="line"><span style="color:#e1e4e8;">  async create(@Body(new CustomValidationPipe()) createUserDto: CreateUserDto) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const newUser = await this.userService.create(createUserDto);</span></span>
<span class="line"><span style="color:#e1e4e8;">    this.logger.log(</span></span>
<span class="line"><span style="color:#e1e4e8;">      `新建用户成功,用户名[${newUser.username}],角色[${newUser.role}]`,</span></span>
<span class="line"><span style="color:#e1e4e8;">    );</span></span>
<span class="line"><span style="color:#e1e4e8;">    return RespBean.success(newUser);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">  @Post()</span></span>
<span class="line"><span style="color:#24292e;">  async create(@Body(new CustomValidationPipe()) createUserDto: CreateUserDto) {</span></span>
<span class="line"><span style="color:#24292e;">    const newUser = await this.userService.create(createUserDto);</span></span>
<span class="line"><span style="color:#24292e;">    this.logger.log(</span></span>
<span class="line"><span style="color:#24292e;">      `新建用户成功,用户名[${newUser.username}],角色[${newUser.role}]`,</span></span>
<span class="line"><span style="color:#24292e;">    );</span></span>
<span class="line"><span style="color:#24292e;">    return RespBean.success(newUser);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>验证如下，将password写成了number而不是string</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dcded6dddd6c4ce1a01c636dd0851bfa~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_3-全局作用域下的pipes" tabindex="-1">3. 全局作用域下的pipes <a class="header-anchor" href="#_3-全局作用域下的pipes" aria-label="Permalink to &quot;3. 全局作用域下的pipes&quot;">​</a></h3><p>依然是两种形式</p><ul><li>使用useGlobalPipes</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">  // 全局validationPipes</span></span>
<span class="line"><span style="color:#e1e4e8;">  app.useGlobalPipes(new CustomValidationPipe());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">  // 全局validationPipes</span></span>
<span class="line"><span style="color:#24292e;">  app.useGlobalPipes(new CustomValidationPipe());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>使用依赖注入，在任意一个模块注入都可以</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      provide: APP_PIPE,</span></span>
<span class="line"><span style="color:#e1e4e8;">      useClass: CustomValidationPipe,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      provide: APP_PIPE,</span></span>
<span class="line"><span style="color:#24292e;">      useClass: CustomValidationPipe,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-内置validationpipe" tabindex="-1">4. 内置validationPipe <a class="header-anchor" href="#_4-内置validationpipe" aria-label="Permalink to &quot;4. 内置validationPipe&quot;">​</a></h3><p>当然讲了这么多，只是说明了原理，其实我们大可不必自己写，直接使用内置的就行，而且提供了丰富的配置自定义功能，具体详情可移步官网：<a href="https://docs.nestjs.com/techniques/validation" target="_blank" rel="noreferrer">https://docs.nestjs.com/techniques/validation</a></p><p>基本使用：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { ValidationPipe } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">app.useGlobalPipes(</span></span>
<span class="line"><span style="color:#e1e4e8;">  new ValidationPipe({</span></span>
<span class="line"><span style="color:#e1e4e8;">    disableErrorMessages: true,</span></span>
<span class="line"><span style="color:#e1e4e8;">  }),</span></span>
<span class="line"><span style="color:#e1e4e8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { ValidationPipe } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">app.useGlobalPipes(</span></span>
<span class="line"><span style="color:#24292e;">  new ValidationPipe({</span></span>
<span class="line"><span style="color:#24292e;">    disableErrorMessages: true,</span></span>
<span class="line"><span style="color:#24292e;">  }),</span></span>
<span class="line"><span style="color:#24292e;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_5-transformation-pipes自定义使用场景" tabindex="-1">5. transformation-pipes自定义使用场景 <a class="header-anchor" href="#_5-transformation-pipes自定义使用场景" aria-label="Permalink to &quot;5. transformation-pipes自定义使用场景&quot;">​</a></h3><p>我们也可以自定义transformation pipes，这个很简单，就是在transform方法内返回不同的结果就行了，它会覆盖之前的value，这是对前端传值的干预，有时候也会很有用</p><ul><li>比如将数据类型进行转换</li><li>对需要的数据如果某个属性不存在那就给它一个默认值，比如做查询操作的时候，有些查询参数没传那就使用默认值</li></ul><p>官网示例：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class ParseIntPipe implements PipeTransform&lt;string, number&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  transform(value: string, metadata: ArgumentMetadata): number {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const val = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (isNaN(val)) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    return val;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class ParseIntPipe implements PipeTransform&lt;string, number&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  transform(value: string, metadata: ArgumentMetadata): number {</span></span>
<span class="line"><span style="color:#24292e;">    const val = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#24292e;">    if (isNaN(val)) {</span></span>
<span class="line"><span style="color:#24292e;">      throw new BadRequestException(&#39;Validation failed&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    return val;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>注意这里PipeTransform&lt;T, R&gt;泛型的使用，T表示输入的类型，R表示返回的类型</p><p>使用和之前讲的一样：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;:id&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">async findOne(@Param(&#39;id&#39;, new ParseIntPipe()) id) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return this.catsService.findOne(id);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;:id&#39;)</span></span>
<span class="line"><span style="color:#24292e;">async findOne(@Param(&#39;id&#39;, new ParseIntPipe()) id) {</span></span>
<span class="line"><span style="color:#24292e;">  return this.catsService.findOne(id);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_6-实现id转user实体的transformation-pipe" tabindex="-1">6. 实现id转user实体的transformation pipe <a class="header-anchor" href="#_6-实现id转user实体的transformation-pipe" aria-label="Permalink to &quot;6. 实现id转user实体的transformation pipe&quot;">​</a></h3><p>这里实现一下官网上的另外一个留给读者的例子，就是前端传入的是一个userId，我们需要在transformation pipe中根据这个id来返回一个用户对象，也就是将id转换为用户</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { UserService } from &#39;../../modules/user/user.service&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class UserByIdPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private readonly userService: UserService) {}</span></span>
<span class="line"><span style="color:#e1e4e8;">  async transform(value: string, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const value1 = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 这里从数据库查找user，我使用的是prisma</span></span>
<span class="line"><span style="color:#e1e4e8;">    const user = await this.userService.findOneById(value1);</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (user) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      // 去除密码</span></span>
<span class="line"><span style="color:#e1e4e8;">      const { password, ...res } = user;</span></span>
<span class="line"><span style="color:#e1e4e8;">      return res;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { ArgumentMetadata, Injectable, PipeTransform } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { UserService } from &#39;../../modules/user/user.service&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class UserByIdPipe implements PipeTransform&lt;any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private readonly userService: UserService) {}</span></span>
<span class="line"><span style="color:#24292e;">  async transform(value: string, metadata: ArgumentMetadata) {</span></span>
<span class="line"><span style="color:#24292e;">    const value1 = parseInt(value, 10);</span></span>
<span class="line"><span style="color:#24292e;">    // 这里从数据库查找user，我使用的是prisma</span></span>
<span class="line"><span style="color:#24292e;">    const user = await this.userService.findOneById(value1);</span></span>
<span class="line"><span style="color:#24292e;">    if (user) {</span></span>
<span class="line"><span style="color:#24292e;">      // 去除密码</span></span>
<span class="line"><span style="color:#24292e;">      const { password, ...res } = user;</span></span>
<span class="line"><span style="color:#24292e;">      return res;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>使用</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;users/:id&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">getUser(@Param(&#39;id&#39;, UserByIdPipe) user: User) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return user;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;users/:id&#39;)</span></span>
<span class="line"><span style="color:#24292e;">getUser(@Param(&#39;id&#39;, UserByIdPipe) user: User) {</span></span>
<span class="line"><span style="color:#24292e;">  return user;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>测试</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/695b8739bce240d8b338c6a4029b7fff~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><h3 id="_7-pipe提供默认值" tabindex="-1">7. pipe提供默认值 <a class="header-anchor" href="#_7-pipe提供默认值" aria-label="Permalink to &quot;7. pipe提供默认值&quot;">​</a></h3><p>主要用在前端传过来的数据是null或者undefined，如果我们不做处理可能会抛出异常，所以我们可以在他们转换前再加一层提供默认值的管道，较为简单，直接引用官方的示例</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get()</span></span>
<span class="line"><span style="color:#e1e4e8;">async findAll(</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Query(&#39;activeOnly&#39;, new DefaultValuePipe(false), ParseBoolPipe) activeOnly: boolean,</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Query(&#39;page&#39;, new DefaultValuePipe(0), ParseIntPipe) page: number,</span></span>
<span class="line"><span style="color:#e1e4e8;">) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return this.catsService.findAll({ activeOnly, page });</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get()</span></span>
<span class="line"><span style="color:#24292e;">async findAll(</span></span>
<span class="line"><span style="color:#24292e;">  @Query(&#39;activeOnly&#39;, new DefaultValuePipe(false), ParseBoolPipe) activeOnly: boolean,</span></span>
<span class="line"><span style="color:#24292e;">  @Query(&#39;page&#39;, new DefaultValuePipe(0), ParseIntPipe) page: number,</span></span>
<span class="line"><span style="color:#24292e;">) {</span></span>
<span class="line"><span style="color:#24292e;">  return this.catsService.findAll({ activeOnly, page });</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="七、guards" tabindex="-1">七、Guards <a class="header-anchor" href="#七、guards" aria-label="Permalink to &quot;七、Guards&quot;">​</a></h2><p>A guard is a class annotated with the @Injectable() decorator, which implements the CanActivate interface.</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bd51a71392a74fc08dab8ae87b427011~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>字面理解就是守卫，它最突出的作用就是用来做鉴权，就是来决定一个请求是否被处理及怎么处理，这依赖于一定的条件，比如权限、角色等等，它和用户权限挂钩。可能有的同志回想用中间件来处理，中间件对一般的要求还可以做到，但是对一些复杂需求，比如不同权限接下去要进行的操作是不一样的，我们使用中间件仅仅靠一个next函数是没法精确控制下一步往哪里走的。</p><p>Guards的执行顺序在所有的中间件之后，但是在任何的interceptor和pipe之前</p><h3 id="_1-基本示例代码" tabindex="-1">1. 基本示例代码 <a class="header-anchor" href="#_1-基本示例代码" aria-label="Permalink to &quot;1. 基本示例代码&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Observable } from &#39;rxjs&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AuthGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#e1e4e8;">  canActivate(</span></span>
<span class="line"><span style="color:#e1e4e8;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#e1e4e8;">    return validateRequest(request);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Observable } from &#39;rxjs&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class AuthGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#24292e;">  canActivate(</span></span>
<span class="line"><span style="color:#24292e;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#24292e;">  ): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#24292e;">    return validateRequest(request);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>使用@Injectable装饰器，实现CanActivate接口</li><li>canActivate方法，重点关注context执行上下文对象，比较强大。</li><li>方法返回true继续执行，返回false拒绝该次请求</li></ul><h3 id="_2-execution-context" tabindex="-1">2. Execution context <a class="header-anchor" href="#_2-execution-context" aria-label="Permalink to &quot;2. Execution context&quot;">​</a></h3><p>继承自ArgumentHost，详情见官网：<a href="https://docs.nestjs.com/fundamentals/execution-context" target="_blank" rel="noreferrer">https://docs.nestjs.com/fundamentals/execution-context</a></p><p>Nest提供了很多实用的工具类来帮我们更轻松的编写应用，Execution context就是其一，后面单独开一篇来将ArgumentsHost和ExecutionContext。</p><h3 id="_3-基于role的权限认证" tabindex="-1">3.基于Role的权限认证 <a class="header-anchor" href="#_3-基于role的权限认证" aria-label="Permalink to &quot;3.基于Role的权限认证&quot;">​</a></h3><p>这里主要讲一个东西就是@SetMetadata的使用，这是用来添加元数据的，我们想实现的功能大概如下：</p><p>在Controller或method-handler上加一个类似Roles(&#39;admin&#39;)装饰器，让只具有admin角色的用户能够访问和调用，如下表示只有admin权限的用户才有资格访问：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Post()</span></span>
<span class="line"><span style="color:#e1e4e8;">@Roles(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  this.catsService.create(createCatDto);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Post()</span></span>
<span class="line"><span style="color:#24292e;">@Roles(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#24292e;">async create(@Body() createCatDto: CreateCatDto) {</span></span>
<span class="line"><span style="color:#24292e;">  this.catsService.create(createCatDto);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如何做到这一点呢?先来个思路分析</p><p>我们在canActivate方法中需要做一下几个事情：</p><ul><li>一是获取当前登录用户的role角色信息，这个可以通过contex拿到request，一般我们会在认证那一步就将user信息附加到request上，这样我们直接通过request.user即可拿到user信息，详见我的系列第一篇，主要就是将用户认证的<a href="https://juejin.cn/post/7171424088827625479" target="_blank" rel="noreferrer">https://juejin.cn/post/7171424088827625479</a></li><li>二是要获取到@Roles()装饰器的参数信息，即标示了哪些用户角色可以访问，这就需要用到两个东西：①Roles装饰器需要自定义，通过对@SetMetadata进行一层包裹，对所装饰的Controller或method添加元数据；②Nest框架给我们提供的反射类，通过反射类拿到装饰器内的参数</li></ul><p>具体做法如下：</p><p>自定义@Roles装饰器</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { SetMetadata } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export const Roles = (...roles: string[]) =&gt; SetMetadata(&#39;roles&#39;, roles);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { SetMetadata } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export const Roles = (...roles: string[]) =&gt; SetMetadata(&#39;roles&#39;, roles);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>构造一个Guard</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Reflector } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class RolesGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#e1e4e8;">  constructor(private reflector: Reflector) {}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">  canActivate(context: ExecutionContext): boolean {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 通过反射拿到，context.getHandler()拿到的是装饰的那个route handler</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 而roles信息就放在Controller的元数据对象上</span></span>
<span class="line"><span style="color:#e1e4e8;">    const roles = this.reflector.get&lt;string[]&gt;(&#39;roles&#39;, context.getHandler());</span></span>
<span class="line"><span style="color:#e1e4e8;">    if (!roles) {</span></span>
<span class="line"><span style="color:#e1e4e8;">      return true;</span></span>
<span class="line"><span style="color:#e1e4e8;">    }</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#e1e4e8;">    // user在这里获取，其实在用户登录的时候会把用户信息都藏到token里，每次用户登录携带token</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 应用在认证token的同时就把用户user信息附加到request中了，认证在这之前所以这里可以拿到</span></span>
<span class="line"><span style="color:#e1e4e8;">    const user = request.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">    return matchRoles(roles, user.roles);</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { Injectable, CanActivate, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Reflector } from &#39;@nestjs/core&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class RolesGuard implements CanActivate {</span></span>
<span class="line"><span style="color:#24292e;">  constructor(private reflector: Reflector) {}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">  canActivate(context: ExecutionContext): boolean {</span></span>
<span class="line"><span style="color:#24292e;">    // 通过反射拿到，context.getHandler()拿到的是装饰的那个route handler</span></span>
<span class="line"><span style="color:#24292e;">    // 而roles信息就放在Controller的元数据对象上</span></span>
<span class="line"><span style="color:#24292e;">    const roles = this.reflector.get&lt;string[]&gt;(&#39;roles&#39;, context.getHandler());</span></span>
<span class="line"><span style="color:#24292e;">    if (!roles) {</span></span>
<span class="line"><span style="color:#24292e;">      return true;</span></span>
<span class="line"><span style="color:#24292e;">    }</span></span>
<span class="line"><span style="color:#24292e;">    const request = context.switchToHttp().getRequest();</span></span>
<span class="line"><span style="color:#24292e;">    // user在这里获取，其实在用户登录的时候会把用户信息都藏到token里，每次用户登录携带token</span></span>
<span class="line"><span style="color:#24292e;">    // 应用在认证token的同时就把用户user信息附加到request中了，认证在这之前所以这里可以拿到</span></span>
<span class="line"><span style="color:#24292e;">    const user = request.user;</span></span>
<span class="line"><span style="color:#24292e;">    return matchRoles(roles, user.roles);</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>对于鉴权后的一些操作，可以根据自己的业务逻辑需要进行定制，至此，Guard基本也讲完了。</p><h2 id="八、interceptors" tabindex="-1">八、Interceptors <a class="header-anchor" href="#八、interceptors" aria-label="Permalink to &quot;八、Interceptors&quot;">​</a></h2><p>An interceptor is a class annotated with the @Injectable() decorator and implements the NestInterceptor interface.</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c6e1e9ce0fad4132abc21760b1bd3cef~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>拦截器！面向切面编程，具有以下能力：</p><ul><li>在某个方法执行前后增加额外逻辑</li><li>修改一个方法返回的结果</li><li>修改一个方法抛出的错误</li><li>扩展一个方法的功能</li><li>根据某些特别的条件，重写一个方法，比如为了缓存目的</li></ul><h3 id="_1-实现接口及方法参数解析" tabindex="-1">1. 实现接口及方法参数解析 <a class="header-anchor" href="#_1-实现接口及方法参数解析" aria-label="Permalink to &quot;1. 实现接口及方法参数解析&quot;">​</a></h3><p>每一个拦截器都需要实现一个NestInterceptor接口，实现里面的intercept方法，接口定义如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/**</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Interface describing implementation of an interceptor.</span></span>
<span class="line"><span style="color:#e1e4e8;"> *</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#e1e4e8;"> *</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @publicApi</span></span>
<span class="line"><span style="color:#e1e4e8;"> */</span></span>
<span class="line"><span style="color:#e1e4e8;">export interface NestInterceptor&lt;T = any, R = any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Method to implement a custom interceptor.</span></span>
<span class="line"><span style="color:#e1e4e8;">     *</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @param context an `ExecutionContext` object providing methods to access the</span></span>
<span class="line"><span style="color:#e1e4e8;">     * route handler and class about to be invoked.</span></span>
<span class="line"><span style="color:#e1e4e8;">     * @param next a reference to the `CallHandler`, which provides access to an</span></span>
<span class="line"><span style="color:#e1e4e8;">     * `Observable` representing the response stream from the route handler.</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    intercept(context: ExecutionContext, next: CallHandler&lt;T&gt;): Observable&lt;R&gt; | Promise&lt;Observable&lt;R&gt;&gt;;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/**</span></span>
<span class="line"><span style="color:#24292e;"> * Interface describing implementation of an interceptor.</span></span>
<span class="line"><span style="color:#24292e;"> *</span></span>
<span class="line"><span style="color:#24292e;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#24292e;"> *</span></span>
<span class="line"><span style="color:#24292e;"> * @publicApi</span></span>
<span class="line"><span style="color:#24292e;"> */</span></span>
<span class="line"><span style="color:#24292e;">export interface NestInterceptor&lt;T = any, R = any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Method to implement a custom interceptor.</span></span>
<span class="line"><span style="color:#24292e;">     *</span></span>
<span class="line"><span style="color:#24292e;">     * @param context an `ExecutionContext` object providing methods to access the</span></span>
<span class="line"><span style="color:#24292e;">     * route handler and class about to be invoked.</span></span>
<span class="line"><span style="color:#24292e;">     * @param next a reference to the `CallHandler`, which provides access to an</span></span>
<span class="line"><span style="color:#24292e;">     * `Observable` representing the response stream from the route handler.</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    intercept(context: ExecutionContext, next: CallHandler&lt;T&gt;): Observable&lt;R&gt; | Promise&lt;Observable&lt;R&gt;&gt;;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>主要看需要实现的intercept方法，它有两个参数context和next</p><h4 id="_1executioncontext" tabindex="-1">①ExecutionContext <a class="header-anchor" href="#_1executioncontext" aria-label="Permalink to &quot;①ExecutionContext&quot;">​</a></h4><p>继承自ArgumentsHost，可以获取执行上下文，有自己的扩展，可以通过反射机制使用getClass()和getHandler()拿到class和method，详情</p><h4 id="_2callhandler" tabindex="-1">②CallHandler <a class="header-anchor" href="#_2callhandler" aria-label="Permalink to &quot;②CallHandler&quot;">​</a></h4><p>CallHandler是一个接口，实现了handle方法，接口如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/**</span></span>
<span class="line"><span style="color:#e1e4e8;"> * Interface providing access to the response stream.</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#e1e4e8;"> * @publicApi</span></span>
<span class="line"><span style="color:#e1e4e8;"> */</span></span>
<span class="line"><span style="color:#e1e4e8;">export interface CallHandler&lt;T = any&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    /**</span></span>
<span class="line"><span style="color:#e1e4e8;">     * Returns an `Observable` representing the response stream from the route</span></span>
<span class="line"><span style="color:#e1e4e8;">     * handler.</span></span>
<span class="line"><span style="color:#e1e4e8;">     */</span></span>
<span class="line"><span style="color:#e1e4e8;">    handle(): Observable&lt;T&gt;;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/**</span></span>
<span class="line"><span style="color:#24292e;"> * Interface providing access to the response stream.</span></span>
<span class="line"><span style="color:#24292e;"> * @see [Interceptors](https://docs.nestjs.com/interceptors)</span></span>
<span class="line"><span style="color:#24292e;"> * @publicApi</span></span>
<span class="line"><span style="color:#24292e;"> */</span></span>
<span class="line"><span style="color:#24292e;">export interface CallHandler&lt;T = any&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    /**</span></span>
<span class="line"><span style="color:#24292e;">     * Returns an `Observable` representing the response stream from the route</span></span>
<span class="line"><span style="color:#24292e;">     * handler.</span></span>
<span class="line"><span style="color:#24292e;">     */</span></span>
<span class="line"><span style="color:#24292e;">    handle(): Observable&lt;T&gt;;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>可以看出，该接口提供了访问Response流的能力，handle()函数的返回值就是response流，类型是一个<code>Observable&lt;T&gt;</code>类型（Observable这是rxjs的内容了，后面有机会单独开一个rxjs的系列，这也是一个非常强大的库，在帮我们处理异步事件的时候用处很大，有兴趣的可移步官网提前学习：<a href="https://rxjs.dev/guide/overview" target="_blank" rel="noreferrer">https://rxjs.dev/guide/overview</a>），你可以在合适的位置使用它来调用你的route handler，如果在intercept()方法的实现中没有调用过handle()方法，那么route handler将不会被执行。</p><p><strong>调用handle()方法前的处理逻辑相当与在route handler之前添加的逻辑，在handle()方法执行后的逻辑相当于在route handler之后添加的逻辑，实现了对route handler的拦截。</strong></p><h3 id="_2-简单示例" tabindex="-1">2. 简单示例 <a class="header-anchor" href="#_2-简单示例" aria-label="Permalink to &quot;2. 简单示例&quot;">​</a></h3><p>我们做一个日志相关的拦截器，实现的目的是route handler处理前记录时间并打印一段提示信息，处理之后打印另一段提示信息并记录route handler的执行时长</p><h4 id="构建拦截器" tabindex="-1">构建拦截器 <a class="header-anchor" href="#构建拦截器" aria-label="Permalink to &quot;构建拦截器&quot;">​</a></h4><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class LoggingInterceptor implements NestInterceptor {</span></span>
<span class="line"><span style="color:#e1e4e8;">  intercept(</span></span>
<span class="line"><span style="color:#e1e4e8;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#e1e4e8;">    next: CallHandler&lt;any&gt;,</span></span>
<span class="line"><span style="color:#e1e4e8;">  ): Observable&lt;any&gt; | Promise&lt;Observable&lt;any&gt;&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    // 处理route handler前的逻辑</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(&#39;Before...&#39;);</span></span>
<span class="line"><span style="color:#e1e4e8;">    const now = Date.now();</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">    return next</span></span>
<span class="line"><span style="color:#e1e4e8;">      .handle().pipe(</span></span>
<span class="line"><span style="color:#e1e4e8;">        tap((value) =&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">          console.log(`After...${Date.now() - now}ms, return value: ${value}`),</span></span>
<span class="line"><span style="color:#e1e4e8;">        ),</span></span>
<span class="line"><span style="color:#e1e4e8;">      );</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class LoggingInterceptor implements NestInterceptor {</span></span>
<span class="line"><span style="color:#24292e;">  intercept(</span></span>
<span class="line"><span style="color:#24292e;">    context: ExecutionContext,</span></span>
<span class="line"><span style="color:#24292e;">    next: CallHandler&lt;any&gt;,</span></span>
<span class="line"><span style="color:#24292e;">  ): Observable&lt;any&gt; | Promise&lt;Observable&lt;any&gt;&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    // 处理route handler前的逻辑</span></span>
<span class="line"><span style="color:#24292e;">    console.log(&#39;Before...&#39;);</span></span>
<span class="line"><span style="color:#24292e;">    const now = Date.now();</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">    return next</span></span>
<span class="line"><span style="color:#24292e;">      .handle().pipe(</span></span>
<span class="line"><span style="color:#24292e;">        tap((value) =&gt;</span></span>
<span class="line"><span style="color:#24292e;">          console.log(`After...${Date.now() - now}ms, return value: ${value}`),</span></span>
<span class="line"><span style="color:#24292e;">        ),</span></span>
<span class="line"><span style="color:#24292e;">      );</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="绑定拦截器" tabindex="-1">绑定拦截器 <a class="header-anchor" href="#绑定拦截器" aria-label="Permalink to &quot;绑定拦截器&quot;">​</a></h4><p>和pipes和guards一样，可以绑定到Controller层、method层以及全局作用域，下面绑定到method层面，使用@UseInterceptors拦截器</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">  @UseInterceptors(LoggingInterceptor)</span></span>
<span class="line"><span style="color:#e1e4e8;">  @Get(&#39;interceptor/test&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  testInterceptor() {</span></span>
<span class="line"><span style="color:#e1e4e8;">    return &#39;hello interceptor&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">  @UseInterceptors(LoggingInterceptor)</span></span>
<span class="line"><span style="color:#24292e;">  @Get(&#39;interceptor/test&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  testInterceptor() {</span></span>
<span class="line"><span style="color:#24292e;">    return &#39;hello interceptor&#39;;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>测试结果</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0fd4e37dbe8d46f392991b68006c7279~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p><strong>如果要绑定全局作用域，可以使用如下两种方式</strong></p><ul><li>useGlobalInterceptors</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">app.useGlobalInterceptors(new LoggingInterceptor());</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">app.useGlobalInterceptors(new LoggingInterceptor());</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>依赖注入方式</li></ul><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Module({</span></span>
<span class="line"><span style="color:#e1e4e8;">  providers: [</span></span>
<span class="line"><span style="color:#e1e4e8;">    {</span></span>
<span class="line"><span style="color:#e1e4e8;">      provide: APP_INTERCEPTOR,</span></span>
<span class="line"><span style="color:#e1e4e8;">      useClass: LoggingInterceptor,</span></span>
<span class="line"><span style="color:#e1e4e8;">    },</span></span>
<span class="line"><span style="color:#e1e4e8;">  ],</span></span>
<span class="line"><span style="color:#e1e4e8;">})</span></span>
<span class="line"><span style="color:#e1e4e8;">export class AppModule {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Module({</span></span>
<span class="line"><span style="color:#24292e;">  providers: [</span></span>
<span class="line"><span style="color:#24292e;">    {</span></span>
<span class="line"><span style="color:#24292e;">      provide: APP_INTERCEPTOR,</span></span>
<span class="line"><span style="color:#24292e;">      useClass: LoggingInterceptor,</span></span>
<span class="line"><span style="color:#24292e;">    },</span></span>
<span class="line"><span style="color:#24292e;">  ],</span></span>
<span class="line"><span style="color:#24292e;">})</span></span>
<span class="line"><span style="color:#24292e;">export class AppModule {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>其实我们可以总结一下关于绑定的方式，我将在核心概念的最后一篇进行一个梳理，对所有涉及到的使用方式做一个总结，其实我个人比较推荐统一都使用注入的方式。</strong></p><h3 id="_3-response结果转换" tabindex="-1">3. response结果转换 <a class="header-anchor" href="#_3-response结果转换" aria-label="Permalink to &quot;3. response结果转换&quot;">​</a></h3><p>由上面可知，我们通过handle()方法拿到了响应流的Observable对象，进而可以对结果进行各种修改转换操作。但是有一点要注意：当route handler中接收 @Res装饰器装饰的参数时不能使用。经过我的测试，发现这么做会阻塞整个请求</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aa868fe9ed064b44bf615c4775e3db01~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>做数据转换的拦截器很简单，只需要在pipe管道中进行map操作就行，可以参考官方的示例：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export interface Response&lt;T&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  data: T;</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">@Injectable()</span></span>
<span class="line"><span style="color:#e1e4e8;">export class TransformInterceptor&lt;T&gt; implements NestInterceptor&lt;T, Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">  intercept(context: ExecutionContext, next: CallHandler): Observable&lt;Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    return next.handle().pipe(map(data =&gt; ({ data })));</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export interface Response&lt;T&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  data: T;</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">@Injectable()</span></span>
<span class="line"><span style="color:#24292e;">export class TransformInterceptor&lt;T&gt; implements NestInterceptor&lt;T, Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#24292e;">  intercept(context: ExecutionContext, next: CallHandler): Observable&lt;Response&lt;T&gt;&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    return next.handle().pipe(map(data =&gt; ({ data })));</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>提示一下，intercept方法依然可以是同步也可以是异步</p><p>map操作可以做任意转换，如：</p><ul><li>将值转换成一个对象</li><li>将null值转换默认的空字符串</li><li>对Exception的转换</li></ul><p>具体的就不做演示了，这个大家应该很熟悉，和js中的map高阶函数一个道理</p><h3 id="_4-结果覆盖" tabindex="-1">4. 结果覆盖 <a class="header-anchor" href="#_4-结果覆盖" aria-label="Permalink to &quot;4. 结果覆盖&quot;">​</a></h3><p>说白了就是某些情况我们不在调用handle处理，为什么呢？可能有时候是多余的，比如结果已经在缓存中有，我们直接在缓存中提取就好了，不用做重复的处理，这可以大大提升性能和响应速度。伪代码逻辑大概如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">const isCached = true;</span></span>
<span class="line"><span style="color:#e1e4e8;">if (isCached) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return of(缓存中的数据);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span>
<span class="line"><span style="color:#e1e4e8;">return next.handle();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">const isCached = true;</span></span>
<span class="line"><span style="color:#24292e;">if (isCached) {</span></span>
<span class="line"><span style="color:#24292e;">  return of(缓存中的数据);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span>
<span class="line"><span style="color:#24292e;">return next.handle();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-其它操作" tabindex="-1">5. 其它操作 <a class="header-anchor" href="#_5-其它操作" aria-label="Permalink to &quot;5. 其它操作&quot;">​</a></h3><p>我们可以充分利用rxjs的强大处理能力，实现更丰富的功能，官方举了一个例子，就是请求处理超时抛出错误的例子，可以参考一下代码，只截取了一部分，pipe中的操作是，超时5s就抛出异常取消该次请求</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">return next.handle().pipe(</span></span>
<span class="line"><span style="color:#e1e4e8;">      timeout(5000),</span></span>
<span class="line"><span style="color:#e1e4e8;">      catchError(err =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">        if (err instanceof TimeoutError) {</span></span>
<span class="line"><span style="color:#e1e4e8;">          return throwError(() =&gt; new RequestTimeoutException());</span></span>
<span class="line"><span style="color:#e1e4e8;">        }</span></span>
<span class="line"><span style="color:#e1e4e8;">        return throwError(() =&gt; err);</span></span>
<span class="line"><span style="color:#e1e4e8;">      }),</span></span>
<span class="line"><span style="color:#e1e4e8;">    );</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">return next.handle().pipe(</span></span>
<span class="line"><span style="color:#24292e;">      timeout(5000),</span></span>
<span class="line"><span style="color:#24292e;">      catchError(err =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">        if (err instanceof TimeoutError) {</span></span>
<span class="line"><span style="color:#24292e;">          return throwError(() =&gt; new RequestTimeoutException());</span></span>
<span class="line"><span style="color:#24292e;">        }</span></span>
<span class="line"><span style="color:#24292e;">        return throwError(() =&gt; err);</span></span>
<span class="line"><span style="color:#24292e;">      }),</span></span>
<span class="line"><span style="color:#24292e;">    );</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="九、custom-decorators" tabindex="-1">九、Custom decorators <a class="header-anchor" href="#九、custom-decorators" aria-label="Permalink to &quot;九、Custom decorators&quot;">​</a></h2><p>装饰器这个概念对JavaScript来说感觉是一次小小的革新，非常好用，其实所谓的装饰器就是一个函数，@的写法是一个语法糖，它可以修饰类、方法、属性及参数，看一下es源码</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61f4971c974f40c49f7e9c82c664d1af~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>nest为我们内置了很多装饰器，各个层面的都有，我们定义类的时候用的最多的就是@Injectable了吧，哈哈，下面我们来自定义一些装饰器，非常好用！</p><h3 id="_1-参数级别装饰器" tabindex="-1">1. 参数级别装饰器 <a class="header-anchor" href="#_1-参数级别装饰器" aria-label="Permalink to &quot;1. 参数级别装饰器&quot;">​</a></h3><p>我们在一个系统登录认证后，token里的user信息都会被附加到request中，我们可以做一个参数装饰器直接获取当前请求携带的user，具体做法如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { createParamDecorator, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;">import { Request } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#e1e4e8;">  (data: unknown, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    return request.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { createParamDecorator, ExecutionContext } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;">import { Request } from &#39;express&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#24292e;">  (data: unknown, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    return request.user;</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>使用</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">  @Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  testUserDecorator(@UserDecorator() user) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(user);</span></span>
<span class="line"><span style="color:#e1e4e8;">    return `hello ${user.username}`;</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">  @Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  testUserDecorator(@UserDecorator() user) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(user);</span></span>
<span class="line"><span style="color:#24292e;">    return `hello ${user.username}`;</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b4d6ea782f340ca93a64ed019fc5548~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>当然这个的前提是你request中得有user啊，这就涉及到认证相关的内容了，可以移步我的nestjs系列第一篇查看：<a href="https://juejin.cn/post/7171424088827625479" target="_blank" rel="noreferrer">https://juejin.cn/post/7171424088827625479</a></p><h3 id="_2-给装饰器传参" tabindex="-1">2. 给装饰器传参 <a class="header-anchor" href="#_2-给装饰器传参" aria-label="Permalink to &quot;2. 给装饰器传参&quot;">​</a></h3><p>给装饰器传参会放到factory方法的data域中，比如我们想给上面的User装饰器传一个属性名username直接获取用户的username，可以这么做：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#e1e4e8;">  (data: string, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#e1e4e8;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#e1e4e8;">    const user = request.user;</span></span>
<span class="line"><span style="color:#e1e4e8;">    return data ? user?.[data] : user;</span></span>
<span class="line"><span style="color:#e1e4e8;">  },</span></span>
<span class="line"><span style="color:#e1e4e8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">export const UserDecorator = createParamDecorator(</span></span>
<span class="line"><span style="color:#24292e;">  (data: string, ctx: ExecutionContext) =&gt; {</span></span>
<span class="line"><span style="color:#24292e;">    const request = ctx.switchToHttp().getRequest&lt;Request&gt;();</span></span>
<span class="line"><span style="color:#24292e;">    const user = request.user;</span></span>
<span class="line"><span style="color:#24292e;">    return data ? user?.[data] : user;</span></span>
<span class="line"><span style="color:#24292e;">  },</span></span>
<span class="line"><span style="color:#24292e;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">  @Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">  testUserDecorator(@UserDecorator(&#39;username&#39;) user) {</span></span>
<span class="line"><span style="color:#e1e4e8;">    console.log(user); // coderlj</span></span>
<span class="line"><span style="color:#e1e4e8;">    return `hello ${user}`; // hello coderlj</span></span>
<span class="line"><span style="color:#e1e4e8;">  }</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">  @Get(&#39;userDec/test&#39;)</span></span>
<span class="line"><span style="color:#24292e;">  testUserDecorator(@UserDecorator(&#39;username&#39;) user) {</span></span>
<span class="line"><span style="color:#24292e;">    console.log(user); // coderlj</span></span>
<span class="line"><span style="color:#24292e;">    return `hello ${user}`; // hello coderlj</span></span>
<span class="line"><span style="color:#24292e;">  }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-结合pipes" tabindex="-1">3. 结合pipes <a class="header-anchor" href="#_3-结合pipes" aria-label="Permalink to &quot;3. 结合pipes&quot;">​</a></h3><p>可以对自定义的装饰器的参数进行校验，下面使用的是框架自带的ValidationPipe</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get()</span></span>
<span class="line"><span style="color:#e1e4e8;">async findOne(</span></span>
<span class="line"><span style="color:#e1e4e8;">  @User(new ValidationPipe({ validateCustomDecorators: true }))</span></span>
<span class="line"><span style="color:#e1e4e8;">  user: UserEntity,</span></span>
<span class="line"><span style="color:#e1e4e8;">) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  console.log(user);</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get()</span></span>
<span class="line"><span style="color:#24292e;">async findOne(</span></span>
<span class="line"><span style="color:#24292e;">  @User(new ValidationPipe({ validateCustomDecorators: true }))</span></span>
<span class="line"><span style="color:#24292e;">  user: UserEntity,</span></span>
<span class="line"><span style="color:#24292e;">) {</span></span>
<span class="line"><span style="color:#24292e;">  console.log(user);</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_4-装饰器组合封装" tabindex="-1">4. 装饰器组合封装 <a class="header-anchor" href="#_4-装饰器组合封装" aria-label="Permalink to &quot;4. 装饰器组合封装&quot;">​</a></h3><p>有时候，我们对一个东西加的装饰器很多，看着代码非常复杂，可以进行抽取重构，将一些经常使用作用可以聚合的放在一起，最后实现用一个装饰器实现对好几个装饰器的封装，如下：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">import { applyDecorators } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">export function Auth(...roles: Role[]) {</span></span>
<span class="line"><span style="color:#e1e4e8;">  return applyDecorators(</span></span>
<span class="line"><span style="color:#e1e4e8;">    SetMetadata(&#39;roles&#39;, roles),</span></span>
<span class="line"><span style="color:#e1e4e8;">    UseGuards(AuthGuard, RolesGuard),</span></span>
<span class="line"><span style="color:#e1e4e8;">    ApiBearerAuth(),</span></span>
<span class="line"><span style="color:#e1e4e8;">    ApiUnauthorizedResponse({ description: &#39;Unauthorized&#39; }),</span></span>
<span class="line"><span style="color:#e1e4e8;">  );</span></span>
<span class="line"><span style="color:#e1e4e8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">import { applyDecorators } from &#39;@nestjs/common&#39;;</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">export function Auth(...roles: Role[]) {</span></span>
<span class="line"><span style="color:#24292e;">  return applyDecorators(</span></span>
<span class="line"><span style="color:#24292e;">    SetMetadata(&#39;roles&#39;, roles),</span></span>
<span class="line"><span style="color:#24292e;">    UseGuards(AuthGuard, RolesGuard),</span></span>
<span class="line"><span style="color:#24292e;">    ApiBearerAuth(),</span></span>
<span class="line"><span style="color:#24292e;">    ApiUnauthorizedResponse({ description: &#39;Unauthorized&#39; }),</span></span>
<span class="line"><span style="color:#24292e;">  );</span></span>
<span class="line"><span style="color:#24292e;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用的时候只需要用一个就行</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">@Get(&#39;users&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">@Auth(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#e1e4e8;">findAllUsers() {}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">@Get(&#39;users&#39;)</span></span>
<span class="line"><span style="color:#24292e;">@Auth(&#39;admin&#39;)</span></span>
<span class="line"><span style="color:#24292e;">findAllUsers() {}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><div class="edit-info" data-v-ef5dee53><div class="edit-link" data-v-ef5dee53><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/Angelxyj/xuxuaimo.guide/edit/main/docs/article/backend/nestjs/NestJS基础/1.九大核心概念.md" target="_blank" rel="noreferrer" data-v-ef5dee53><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-ef5dee53><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> Edit this page on Github<!--]--></a></div><div class="last-updated" data-v-ef5dee53><p class="VPLastUpdated" data-v-ef5dee53 data-v-7e05ebdb>最近更新时间: <time datetime="2024-02-13T15:45:01.000Z" data-v-7e05ebdb></time></p></div></div><nav class="prev-next" data-v-ef5dee53><div class="pager" data-v-ef5dee53><!----></div><div class="pager" data-v-ef5dee53><a class="pager-link next" href="/xuxiaomo.guide/article/backend/nestjs/NestJS%E5%9F%BA%E7%A1%80/2.%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E5%B0%8F%E7%BB%93.html" data-v-ef5dee53><span class="desc" data-v-ef5dee53>Next page</span><span class="title" data-v-ef5dee53>2.核心概念小结</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5a346dfe data-v-e03eb2e1><div class="container" data-v-e03eb2e1><p class="message" data-v-e03eb2e1>Released under the MIT License.</p><p class="copyright" data-v-e03eb2e1>Copyright © 2021 Coder 许小墨</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"article_backend_nestjs_nestjs基础_2.核心概念小结.md\":\"48b26738\",\"article_frontend_javascript_index.md\":\"f6351854\",\"article_frontend_next_index.md\":\"b99bffc0\",\"article_frontend_next_基础知识_1.安装使用.md\":\"8c8ab066\",\"article_frontend_tauri_特性_6.插件系统(todo).md\":\"55dc56da\",\"article_frontend_tauri_特性_7.初始化屏幕.md\":\"637360e6\",\"article_frontend_tauri_特性_9.窗口自定义.md\":\"fddf2442\",\"article_backend_nginx_配置相关_1.默认配置.md\":\"2ea31605\",\"article_bigman_工具网站_9.qq机器人.md\":\"6e5b42ce\",\"article_bigman_工具网站_7.automa自动化工具.md\":\"5f0965f9\",\"article_frontend_tauri_特性_8.系统托盘.md\":\"e61416e1\",\"article_bug_服务器_2-linux.md\":\"10c149a7\",\"article_frontend_css_移动端适配_1.邂逅移动端.md\":\"6ef66073\",\"article_colorfullife_index.md\":\"6c4a2c2c\",\"article_colorfullife_杂七杂八_2.ideavim配置.md\":\"bd86c2c9\",\"article_colorfullife_杂七杂八_1.vitepress侧边栏生成脚本.md\":\"4fd70b97\",\"article_frontend_css_index.md\":\"0690bbe7\",\"article_backend_cpp_基础知识_3.c__ primer语录集.md\":\"65d4039d\",\"article_frontend_tauri_特性_4.窗口菜单栏.md\":\"451f6bfa\",\"article_backend_nginx_基础知识_2.随机主页模块.md\":\"61eba161\",\"article_bug_服务器_3-vscode.md\":\"8edab31b\",\"article_backend_nginx_基础知识_1.连接状态模块.md\":\"aeabd135\",\"article_frontend_可视化_index.md\":\"ccf7d602\",\"article_backend_cpp_index.md\":\"afd9371a\",\"article_backend_cpp_基础知识_5.cmake教程.md\":\"b63e8b1f\",\"article_colorfullife_个人总结_2022年终.md\":\"356bce8b\",\"column_algorithm_index.md\":\"eff1a876\",\"article_backend_gitlearn_远程仓库_1.github仓库.md\":\"2201c971\",\"column_frontend_vueprinciple_index.md\":\"53bcd093\",\"article_colorfullife_杂七杂八_3.爬虫和js逆向.md\":\"d9f093ab\",\"article_bigman_工具网站_1.科学上网.md\":\"f53fddc0\",\"article_frontend_tauri_特性_5.多窗口.md\":\"0957c24f\",\"article_frontend_next_基础知识_3.渲染.md\":\"5f818393\",\"article_backend_gitlearn_index.md\":\"1f9f329c\",\"column_interview_operatingsystem.md\":\"6383cb01\",\"column_frontend_vue_index.md\":\"7647fc1c\",\"article_backend_nestjs_nestjs进阶_2.生命周期.md\":\"ca7b4ebc\",\"column_interview_css.md\":\"9689ec89\",\"column_frontend_vueprinciple_001.md\":\"41f19a06\",\"column_product_softwaretesting_001.md\":\"c9a881e5\",\"article_backend_cpp_qt_3.模型视图.md\":\"fcdef34a\",\"article_bigman_工具网站_3.音视频小能手.md\":\"b91cb218\",\"column_product_softwareengineer_005measure.md\":\"6d7c3734\",\"column_frontend_javascript_010.md\":\"2ce92747\",\"article_backend_nginx_index.md\":\"d37a4fb3\",\"column_frontend_youthcamp_006.md\":\"11479d19\",\"article_backend_nginx_配置相关_6.proxy代理.md\":\"602e9676\",\"article_backend_nestjs_实用工具包_1.class-transformer.md\":\"a8e6f884\",\"column_frontend_webpack_004.md\":\"1b2dcd3e\",\"article_frontend_react_hooks详解_1.usecallback和usememo.md\":\"b1893609\",\"article_frontend_typescript_index.md\":\"b86db5e9\",\"article_frontend_vue_index.md\":\"755e9cff\",\"article_bigman_工具网站_8.欧陆词典破解.md\":\"ee50bee1\",\"column_algorithm_002_queue.md\":\"be18e51d\",\"article_backend_nodejs_包管理工具_3.npm安装离线包.md\":\"0b5437da\",\"article_backend_nodejs_包管理工具_2.pnpm使用.md\":\"a2fe342c\",\"article_backend_nodejs_包管理工具_1.软连接和硬链接.md\":\"9257e256\",\"column_algorithm_006_graph.md\":\"39dc8c1b\",\"article_bigman_index.md\":\"17130f93\",\"article_bigman_工具网站_6.正则大全.md\":\"e51069ed\",\"column_growing_index.md\":\"55f4777b\",\"article_backend_nodejs_index.md\":\"e638962c\",\"article_backend_cpp_qt_1.元对象系统.md\":\"f7020786\",\"article_backend_csharp_index.md\":\"42b04cd1\",\"article_backend_nginx_配置相关_5.代理.md\":\"53743b85\",\"column_frontend_react_001.md\":\"5e978532\",\"column_product_softwareengineer_002processmodel.md\":\"4c202c97\",\"column_product_softwareengineer_012softwaretest.md\":\"9321892b\",\"column_algorithm_008_dynamics.md\":\"6f5128c8\",\"column_frontend_webpack_005.md\":\"b8b35ba9\",\"column_frontend_practice_001.md\":\"ca251d03\",\"column_frontend_javascript_008.md\":\"8a7fa008\",\"column_frontend_typescript_001_tsintro.md\":\"a14088eb\",\"column_interview_browser.md\":\"e0c0a1a5\",\"column_interview_html5.md\":\"d98e16b2\",\"column_frontend_youthcamp_009.md\":\"fde942d9\",\"column_frontend_youthcamp_007.md\":\"58871ffd\",\"column_backend_node_003_graffitiboard.md\":\"f594aa0c\",\"column_algorithm_004_dictionary.md\":\"9048906c\",\"column_frontend_javascript_009.md\":\"635ab5af\",\"column_frontend_javascript_001.md\":\"3fe8091b\",\"column_basecommand_macshortcutkey_003_console.md\":\"e4f7df6d\",\"column_algorithm_001_stack.md\":\"44ea92db\",\"column_interview_network.md\":\"ab2f58bd\",\"column_frontend_youthcamp_011.md\":\"ce543497\",\"column_frontend_youthcamp_010.md\":\"ff998593\",\"column_interview_javascript.md\":\"92eab6a9\",\"column_computerknowledge_security_001.md\":\"65a03916\",\"column_frontend_componentlib_001.md\":\"38c056bd\",\"column_frontend_vue_003.md\":\"3d719018\",\"column_backend_node_002_fullstack.md\":\"ab0f2421\",\"column_frontend_youthcamp_002.md\":\"887d0fdb\",\"article_frontend_tauri_index.md\":\"5e466af1\",\"column_frontend_index.md\":\"9962c786\",\"column_product_softwaretesting_005.md\":\"9373e2e2\",\"article_backend_nginx_其它_3.http状态码.md\":\"ccefec92\",\"column_product_softwaretesting_002.md\":\"7262e9e7\",\"article_frontend_html_index.md\":\"cc5d8435\",\"article_backend_nestjs_nestjs进阶_4.环境变量.md\":\"13ab9acd\",\"column_frontend_vue_007.md\":\"0b1f576e\",\"column_frontend_javascript_006.md\":\"dacfb67a\",\"article_bigman_工具网站_5.图床.md\":\"1ad482a2\",\"article_frontend_tauri_特性_3.图标.md\":\"e410c466\",\"column_product_softwaretesting_003.md\":\"cab72c10\",\"column_computerknowledge_index.md\":\"51cdbc23\",\"article_frontend_react_index.md\":\"290339f5\",\"column_algorithm_003_linkedlist.md\":\"70abeaf5\",\"article_backend_gitlearn_远程仓库_2.pull拉取更新.md\":\"5e943bd6\",\"article_frontend_tauri_特性_1.commands指令系统.md\":\"3faaf267\",\"article_frontend_ui_index.md\":\"3acccfa7\",\"article_frontend_react_hooks详解_2.useref使用.md\":\"b8f634a4\",\"article_backend_nginx_其它_1.日志.md\":\"e616079a\",\"article_backend_nginx_配置相关_3.子配置目录.md\":\"8f667f86\",\"column_basecommand_macshortcutkey_001_vscode.md\":\"3ca73da6\",\"article_backend_nestjs_安全认证_1.登录认证(jwt).md\":\"c6665abb\",\"article_backend_nginx_基础知识_5.文件压缩模块.md\":\"e5de6ebc\",\"column_interview_vue.md\":\"4089b945\",\"column_otherlang_php_003.md\":\"a3e72b25\",\"article_bug_服务器_1-ssh.md\":\"5b97c310\",\"column_basecommand_macshortcutkey_008_linux.md\":\"45362a79\",\"column_interview_datastructure.md\":\"4220cc8c\",\"column_frontend_youthcamp_003.md\":\"a327a3af\",\"column_frontend_vueprinciple_003.md\":\"088e2323\",\"column_product_softwareengineer_010dataflowdiagram.md\":\"e5f46dfa\",\"column_frontend_typescript_002_tsdecorator.md\":\"2b1d6a79\",\"column_frontend_javascript_003.md\":\"73150e39\",\"column_frontend_vueprinciple_004.md\":\"64dbc4c8\",\"column_interview_typescript.md\":\"5cccbc8a\",\"column_frontend_youthcamp_001.md\":\"dc8a109f\",\"column_frontend_webpack_002.md\":\"e0a7184c\",\"column_basecommand_winshortcutkey_003.md\":\"62e7e9fe\",\"column_basecommand_index.md\":\"80afc363\",\"column_otherlang_php_002.md\":\"1f8f51cb\",\"column_algorithm_009_greedy.md\":\"7a5390c7\",\"column_interview_designmode.md\":\"38e497f8\",\"column_frontend_webpack_001.md\":\"ee0301e5\",\"column_guide_index.md\":\"033fd621\",\"column_basecommand_macshortcutkey_006_notion.md\":\"06105fff\",\"column_product_softwaretesting_006.md\":\"2b1d2014\",\"column_frontend_vue_009_vitepress_blog.md\":\"5c86475d\",\"column_product_softwareengineer_index.md\":\"564fc9e5\",\"article_bigman_工具网站_2.密码小能手.md\":\"6e4ac734\",\"column_computerknowledge_browser_002.md\":\"ac362bc7\",\"column_frontend_componentlib_002.md\":\"1995ab92\",\"column_algorithm_007_heap.md\":\"728b0c36\",\"article_backend_nestjs_nestjs进阶_5.整合prisma(todo).md\":\"41c27112\",\"article_backend_nginx_配置相关_4.location参数.md\":\"fc2ddd61\",\"column_product_softwareengineer_000guide.md\":\"05058f24\",\"column_otherlang_php_001.md\":\"d2c26bce\",\"column_frontend_youthcamp_008.md\":\"4e510345\",\"column_frontend_css_001.md\":\"f6edc84e\",\"column_frontend_youthcamp_005.md\":\"170887a0\",\"column_frontend_vue_005.md\":\"83d777b9\",\"column_frontend_vue_008_vue3api.md\":\"cec86836\",\"column_algorithm_010_search.md\":\"bfa16a18\",\"column_frontend_react_004.md\":\"5a3d5c11\",\"article_backend_gitlearn_常用命令_4.reset指令.md\":\"96dc93d6\",\"column_frontend_react_002.md\":\"3915c500\",\"column_frontend_vue_006.md\":\"e5522e9e\",\"column_product_softwareengineer_003prototype.md\":\"49c8629d\",\"column_product_softwareengineer_004product.md\":\"79f35130\",\"column_product_softwareengineer_013uml.md\":\"090dfe34\",\"column_basecommand_macshortcutkey_002_macos.md\":\"0446863c\",\"article_backend_cpp_qt_2.配置相关.md\":\"651a12b4\",\"column_product_softwareengineer_009structuredanalysis.md\":\"9688e074\",\"column_product_softwareengineer_001definition.md\":\"7bab5427\",\"column_otherlang_index.md\":\"7ce85c3e\",\"article_backend_nginx_基础知识_6.页面缓存模块.md\":\"ab29a135\",\"column_backend_index.md\":\"59f63fda\",\"article_frontend_next_基础知识_2.路由系统.md\":\"3ef50be3\",\"article_frontend_react_我的模板_1.ts-template.md\":\"00d1d584\",\"column_frontend_typescript_003_tsintro2.md\":\"146e4b46\",\"column_frontend_vue_004.md\":\"7d4cdea6\",\"article_backend_gitlearn_远程仓库_3.push命令.md\":\"56ee65bb\",\"article_backend_gitlearn_基本配置_3.git原理图.md\":\"de422fa4\",\"column_frontend_vue_002.md\":\"78ebf87f\",\"column_frontend_javascript_005.md\":\"9f4dd900\",\"column_product_softwareengineer_007riskanalysis.md\":\"9a7f18ae\",\"column_basecommand_winshortcutkey_002.md\":\"89b82c03\",\"article_backend_nestjs_nestjs进阶_6.缓存(todo).md\":\"9da6607a\",\"article_frontend_css_移动端适配_3.适配方案.md\":\"00f4fca4\",\"column_algorithm_005_tree.md\":\"b74c3941\",\"column_frontend_webpack_003.md\":\"962d3674\",\"column_interview_node.md\":\"74fb4096\",\"column_product_softwaretesting_004.md\":\"52d6e2cc\",\"column_product_index.md\":\"dda3e98a\",\"column_travel_eastchina_index.md\":\"5b9f13aa\",\"column_product_softwaretesting_index.md\":\"93323b72\",\"column_basecommand_winshortcutkey_001.md\":\"dd9ef08d\",\"column_travel_index.md\":\"06aea2b1\",\"column_template_index.md\":\"e26afcc1\",\"article_bug_服务器_4-mysql.md\":\"8129c5cb\",\"column_computerknowledge_browser_001.md\":\"c6ba1cfd\",\"article_backend_cpp_qt_4.事件系统.md\":\"5662e2ca\",\"column_interview_jswriting.md\":\"b7031fd9\",\"column_frontend_javascript_002.md\":\"468f769a\",\"column_frontend_css_002.md\":\"4248791b\",\"article_bigman_工具网站_4.绘图小能手.md\":\"572f50ff\",\"column_frontend_react_003.md\":\"44bead57\",\"column_template_notion_index.md\":\"3a515f84\",\"article_backend_gitlearn_常用命令_6.tag打标签.md\":\"57dca063\",\"article_backend_nestjs_index.md\":\"a0a148f3\",\"article_backend_gitlearn_常用命令_5.stashing临时存储工作.md\":\"af77af9d\",\"article_backend_nginx_配置相关_2.主配置文件.md\":\"d0507f70\",\"column_growing_reviewsummary_001.md\":\"23d201f3\",\"article_backend_nginx_基础知识_4.文件读取模块.md\":\"4cf4b05a\",\"article_backend_nestjs_nestjs进阶_3.打包部署(⚑).md\":\"bb1e160d\",\"article_frontend_css_移动端适配_2.视口.md\":\"46dfcd02\",\"article_backend_gitlearn_其它工具_1.degit文档.md\":\"1cf2ece1\",\"column_interview_react.md\":\"67794142\",\"column_frontend_javascript_004.md\":\"bdd2467d\",\"article_backend_gitlearn_基本配置_1.初识配置.md\":\"82648bff\",\"article_backend_cpp_基础知识_2.自学总结.md\":\"25d8f51f\",\"column_basecommand_macshortcutkey_005_typora.md\":\"77206fa8\",\"article_backend_csharp_基础知识_1.maui相关.md\":\"fb00fd1f\",\"column_basecommand_macshortcutkey_007_git.md\":\"026017b9\",\"column_basecommand_macshortcutkey_004_google.md\":\"d9ac2baf\",\"column_interview_csswriting.md\":\"e3ee4892\",\"article_backend_gitlearn_常用命令_7.git动画(精品☆).md\":\"fd2b029b\",\"column_basecommand_winshortcutkey_004.md\":\"d283e8c5\",\"column_basecommand_macshortcutkey_009_lark.md\":\"1efd2541\",\"index.md\":\"9420bed9\",\"column_interview_performance.md\":\"cce14863\",\"article_bug_index.md\":\"a54b919c\",\"article_backend_nestjs_nestjs进阶_1.依赖注入.md\":\"4c038f7a\",\"article_backend_gitlearn_常用命令_2.工作区和暂存区.md\":\"82c7da08\",\"article_backend_nginx_基础知识_3.替换模块.md\":\"67ea9629\",\"article_backend_gitlearn_常用命令_3.分支管理.md\":\"2be8e938\",\"column_product_softwareengineer_011structureddesign.md\":\"11efe65c\",\"column_product_softwareengineer_006scope.md\":\"14820f74\",\"article_backend_nestjs_nestjs基础_3.executioncontext补充.md\":\"54c12ad6\",\"column_interview_development.md\":\"4805bdd1\",\"article_frontend_react_基础知识_1.邂逅react.md\":\"a3c06bb3\",\"article_backend_nestjs_nestjs基础_1.九大核心概念.md\":\"dafdc3d7\",\"column_product_softwareengineer_008schedule.md\":\"7b919915\",\"article_frontend_tauri_特性_2.事件.md\":\"a178f869\",\"column_growing_yearsummary_001.md\":\"7a599638\",\"column_interview_leetcode.md\":\"7781d742\",\"column_interview_webpack.md\":\"d6fe5032\",\"column_frontend_vue_001.md\":\"24b256a1\",\"column_frontend_vueprinciple_002.md\":\"50d741f1\",\"column_interview_index.md\":\"385bf4a6\",\"column_backend_node_001_deploy.md\":\"ada67528\",\"column_computerknowledge_performanceoptimization_001.md\":\"e261031d\",\"column_frontend_javascript_007.md\":\"89cd56be\",\"article_backend_gitlearn_基本配置_2.配置别名.md\":\"6df72bcd\",\"article_backend_cpp_基础知识_4.侯捷.md\":\"a7e11baa\",\"article_backend_nginx_其它_2.文件关联程序.md\":\"6f3e4aaf\",\"article_backend_gitlearn_常用命令_1.常用命令.md\":\"8e5d3701\",\"column_otherlang_android_001.md\":\"a4c5efa3\",\"column_frontend_translation_001.md\":\"8a60167c\",\"column_frontend_youthcamp_004.md\":\"ba61ea9a\",\"column_frontend_react_005.md\":\"3b07d399\",\"article_backend_cpp_基础知识_1.cherno教程.md\":\"020874ba\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"许小墨のGuide\",\"description\":\"分享前沿学习干货，不止前端\",\"base\":\"/xuxiaomo.guide/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"/common/avatar.png\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"个人成长\",\"items\":[{\"text\":\"大江南北游记\",\"link\":\"/column/Travel/\"},{\"text\":\"所思·所想\",\"link\":\"/column/Growing/\"}]},{\"text\":\"干货社区\",\"items\":[{\"text\":\"快捷键\",\"link\":\"/column/BaseCommand/\"},{\"text\":\"模板管理\",\"link\":\"/column/Template/\"}]},{\"text\":\"精选专栏\",\"items\":[{\"text\":\"数构与前端\",\"link\":\"/column/Algorithm/\"},{\"text\":\"offer来了\",\"link\":\"/column/Interview/\"}]},{\"text\":\"分类索引\",\"items\":[{\"text\":\"产品汪\",\"link\":\"/column/Product/\"},{\"text\":\"前端开发\",\"link\":\"/column/FrontEnd/\"},{\"text\":\"其他语言\",\"link\":\"/column/OtherLang/\"},{\"text\":\"服务端开发\",\"link\":\"/column/BackEnd/\"},{\"text\":\"计算机基础知识\",\"link\":\"/column/ComputerKnowledge/\"},{\"text\":\"碎碎念个人成长\",\"link\":\"/column/Growing/\"}]},{\"text\":\"其他\",\"items\":[{\"text\":\"巨人的肩膀\",\"link\":\"/article/bigMan/\"},{\"text\":\"bug集中营\",\"link\":\"/article/bug/\"},{\"text\":\"缤纷世界\",\"link\":\"/article/colorfulLife/\"}]},{\"text\":\"关于我\",\"items\":[{\"text\":\"CSDN\",\"link\":\"https://blog.csdn.net/qq_60306931\"},{\"text\":\"Github\",\"link\":\"https://github.com/Angelxyj\"},{\"text\":\"Gitee\",\"link\":\"https://gitee.com/Angelxyj\"},{\"text\":\"私人博客\",\"link\":\"https://angelxyj.gitee.io/xuxiaomo.blog\"},{\"text\":\"技术文档\",\"link\":\"https://angelxyj.gitee.io/xuxiaomo.docs\"}]}],\"sidebar\":{\"/column/Algorithm/\":[{\"text\":\"数据结构在前端中的应用\",\"items\":[{\"text\":\"栈-深拷贝和浅拷贝\",\"link\":\"/column/Algorithm/001_Stack\"},{\"text\":\"队列-事件循环\",\"link\":\"/column/Algorithm/002_Queue\"},{\"text\":\"链表-原型和原型链\",\"link\":\"/column/Algorithm/003_LinkedList\"},{\"text\":\"字典和集合-Set和Map\",\"link\":\"/column/Algorithm/004_Dictionary\"},{\"text\":\"树-深/广度优先遍历\",\"link\":\"/column/Algorithm/005_Tree\"},{\"text\":\"图-邻接矩阵/邻接表\",\"link\":\"/column/Algorithm/006_Graph\"},{\"text\":\"堆-最大堆/最小堆\",\"link\":\"/column/Algorithm/007_Heap\"}]},{\"text\":\"算法在前端中的应用\",\"items\":[{\"text\":\"分治思想和动态规划\",\"link\":\"/column/Algorithm/008_Dynamics\"},{\"text\":\"贪心算法和回溯算法\",\"link\":\"/column/Algorithm/009_Greedy\"},{\"text\":\"搜索和排序算法\",\"link\":\"/column/Algorithm/010_Search\"}]}],\"/column/Interview/\":[{\"text\":\"前端三件套\",\"items\":[{\"text\":\"HTML篇\",\"link\":\"/column/Interview/Html5\"},{\"text\":\"CSS篇\",\"link\":\"/column/Interview/CSS\"},{\"text\":\"JavaScript篇\",\"link\":\"/column/Interview/JavaScript\"}]},{\"text\":\"计算机基础知识\",\"items\":[{\"text\":\"计算机网络\",\"link\":\"/column/Interview/Network\"},{\"text\":\"浏览器原理\",\"link\":\"/column/Interview/Browser\"},{\"text\":\"计算机操作系统\",\"link\":\"/column/Interview/OperatingSystem\"}]},{\"text\":\"框架和项目\",\"items\":[{\"text\":\"vue.js篇\",\"link\":\"/column/Interview/Vue\"},{\"text\":\"react.js篇\",\"link\":\"/column/Interview/React\"},{\"text\":\"node.js篇\",\"link\":\"/column/Interview/Node\"},{\"text\":\"TypeScript篇\",\"link\":\"/column/Interview/TypeScript\"},{\"text\":\"Webpack篇\",\"link\":\"/column/Interview/Webpack\"},{\"text\":\"性能优化篇\",\"link\":\"/column/Interview/Performance\"},{\"text\":\"开发环境篇\",\"link\":\"/column/Interview/Development\"},{\"text\":\"JavaScript设计模式\",\"link\":\"/column/Interview/DesignMode\"}]},{\"text\":\"手写系列\",\"items\":[{\"text\":\"CSS手写系列\",\"link\":\"/column/Interview/CSSWriting\"},{\"text\":\"JavaScript手写系列\",\"link\":\"/column/Interview/JSWriting\"}]},{\"text\":\"算法系列\",\"items\":[{\"text\":\"数据结构与算法\",\"link\":\"/column/Interview/DataStructure\"},{\"text\":\"leetcode算法题\",\"link\":\"/column/Interview/Leetcode\"}]}],\"/column/ComputerKnowledge/\":[{\"text\":\"浏览器原理\",\"items\":[{\"text\":\"浏览器存储问题\",\"link\":\"/column/ComputerKnowledge/Browser/001\"},{\"text\":\"图解强缓存和弱缓存\",\"link\":\"/column/ComputerKnowledge/Browser/002\"}]},{\"text\":\"前端安全\",\"items\":[{\"text\":\"xss和csrf\",\"link\":\"/column/ComputerKnowledge/Security/001\"}]},{\"text\":\"性能优化\",\"items\":[{\"text\":\"防抖和节流\",\"link\":\"/column/ComputerKnowledge/PerformanceOptimization/001\"}]}],\"/column/FrontEnd/\":[{\"text\":\"CSS\",\"items\":[{\"text\":\"001-position和z-index\",\"link\":\"/column/FrontEnd/CSS/001\"},{\"text\":\"002-CSS选择器优先级\",\"link\":\"/column/FrontEnd/CSS/002\"}]},{\"text\":\"JavaScript\",\"items\":[{\"text\":\"001-作用域和闭包\",\"link\":\"/column/FrontEnd/JavaScript/001\"},{\"text\":\"002-this的应用场景\",\"link\":\"/column/FrontEnd/JavaScript/002\"},{\"text\":\"003-promise和async/await\",\"link\":\"/column/FrontEnd/JavaScript/003\"},{\"text\":\"004-Web API种的DOM和BOM\",\"link\":\"/column/FrontEnd/JavaScript/004\"},{\"text\":\"005-事件绑定、事件冒泡和事件委托\",\"link\":\"/column/FrontEnd/JavaScript/005\"},{\"text\":\"006-跨域大山AJAX\",\"link\":\"/column/FrontEnd/JavaScript/006\"},{\"text\":\"007-HTMLCollection和NodeList\",\"link\":\"/column/FrontEnd/JavaScript/007\"},{\"text\":\"008-JS中的七大继承方案\",\"link\":\"/column/FrontEnd/JavaScript/008\"},{\"text\":\"009-手写Promise的核心功能\",\"link\":\"/column/FrontEnd/JavaScript/009\"}]},{\"text\":\"vue.js\",\"items\":[{\"text\":\"001-vue的基本使用和高级特性\",\"link\":\"/column/FrontEnd/VUE/001\"},{\"text\":\"002-vue3基础新特性\",\"link\":\"/column/FrontEnd/VUE/002\"},{\"text\":\"003-vue3新特性：ref、toRef和toRefs\",\"link\":\"/column/FrontEnd/VUE/003\"},{\"text\":\"004-vue3进阶新特性\",\"link\":\"/column/FrontEnd/VUE/004\"},{\"text\":\"005-vue3模块化妙用\",\"link\":\"/column/FrontEnd/VUE/005\"},{\"text\":\"006-vue3的teleport和suspense\",\"link\":\"/column/FrontEnd/VUE/006\"},{\"text\":\"007-前端路由hash和history\",\"link\":\"/column/FrontEnd/VUE/007\"},{\"text\":\"008-重温 vue3 composition-api\",\"link\":\"/column/FrontEnd/VUE/008_vue3api\"}]},{\"text\":\"react.js\",\"items\":[{\"text\":\"001-初探react\",\"link\":\"/column/FrontEnd/React/001\"},{\"text\":\"002-react进阶知识\",\"link\":\"/column/FrontEnd/React/002\"},{\"text\":\"003-Redux从入门到进阶\",\"link\":\"/column/FrontEnd/React/003\"},{\"text\":\"004-react的基本使用和高级特性\",\"link\":\"/column/FrontEnd/React/004\"},{\"text\":\"005-React hooks\",\"link\":\"/column/FrontEnd/React/005\"}]},{\"text\":\"vue.js原理解析\",\"items\":[{\"text\":\"001-vue2响应式原理\",\"link\":\"/column/FrontEnd/VUEPrinciple/001\"},{\"text\":\"002-虚拟DOM和diff算法\",\"link\":\"/column/FrontEnd/VUEPrinciple/002\"},{\"text\":\"003-模板编译template的背后\",\"link\":\"/column/FrontEnd/VUEPrinciple/003\"},{\"text\":\"004-vue3响应式原理\",\"link\":\"/column/FrontEnd/VUEPrinciple/004\"}]},{\"text\":\"TypeScript\",\"items\":[{\"text\":\"001-TS入门小知识\",\"link\":\"/column/FrontEnd/TypeScript/001_tsIntro\"},{\"text\":\"002-ts装饰器\",\"link\":\"/column/FrontEnd/TypeScript/002_tsDecorator\"},{\"text\":\"003-ts进阶\",\"link\":\"/column/FrontEnd/TypeScript/003_tsIntro2\"}]},{\"text\":\"Webpack\",\"items\":[{\"text\":\"001-webpack超入门核心知识\",\"link\":\"/column/FrontEnd/Webpack/001\"},{\"text\":\"002-webpack入门进阶知识\",\"link\":\"/column/FrontEnd/Webpack/002\"},{\"text\":\"003-手写一个loader和plugin\",\"link\":\"/column/FrontEnd/Webpack/003\"},{\"text\":\"004-webpack实战案例配置\",\"link\":\"/column/FrontEnd/Webpack/004\"},{\"text\":\"005-手写bundler打包工具\",\"link\":\"/column/FrontEnd/Webpack/005\"}]},{\"text\":\"vue3+ts组件库开发\",\"items\":[{\"text\":\"001-全局Header和列表数据渲染ColumnList\",\"link\":\"/column/FrontEnd/ComponentLib/001\"},{\"text\":\"002-Web世界中的表单验证\",\"link\":\"/column/FrontEnd/ComponentLib/002\"}]},{\"text\":\"实战类\",\"items\":[{\"text\":\"001-中秋节网页\",\"link\":\"/column/FrontEnd/Practice/001\"}]},{\"text\":\"其他\",\"items\":[{\"text\":\"001-HTML基础\",\"link\":\"/column/FrontEnd/YouthCamp/001\"},{\"text\":\"002-CSS的奥秘\",\"link\":\"/column/FrontEnd/YouthCamp/002\"},{\"text\":\"003-UI设计\",\"link\":\"/column/FrontEnd/YouthCamp/003\"},{\"text\":\"004-如何写好JS（上）\",\"link\":\"/column/FrontEnd/YouthCamp/004\"},{\"text\":\"005-如何写好JS（下）\",\"link\":\"/column/FrontEnd/YouthCamp/005\"},{\"text\":\"006-Web视觉下的前端开发\",\"link\":\"/column/FrontEnd/YouthCamp/006\"},{\"text\":\"007-红绿灯梭行\",\"link\":\"/column/FrontEnd/YouthCamp/007\"},{\"text\":\"008-幂等问题\",\"link\":\"/column/FrontEnd/YouthCamp/008\"},{\"text\":\"009-扑克牌洗牌问题\",\"link\":\"/column/FrontEnd/YouthCamp/009\"},{\"text\":\"010-微信抢红包功能\",\"link\":\"/column/FrontEnd/YouthCamp/010\"}]},{\"text\":\"掘金翻译计划\",\"items\":[{\"text\":\"001-JS中的测试工具\",\"link\":\"/column/FrontEnd/Translation/001\"}]}],\"/column/BackEnd/\":[{\"text\":\"Node.js\",\"items\":[{\"text\":\"001-项目部署到阿里云服务器\",\"link\":\"/column/BackEnd/Node/001_deploy\"},{\"text\":\"002-《从前端到全栈》小册钻研\",\"link\":\"/column/BackEnd/Node/002_fullStack\"},{\"text\":\"003-前端工程化基础\",\"link\":\"/column/BackEnd/Node/003_graffitiBoard\"}]},{\"text\":\"开发环境Linux\",\"items\":[]}],\"/column/OtherLang\":[{\"text\":\"Android\",\"items\":[{\"text\":\"001-个人记账App\",\"link\":\"/column/OtherLang/Android/001\"}]},{\"text\":\"PHP\",\"items\":[{\"text\":\"001-PHP第一个项目：HelloWorld\",\"link\":\"/column/OtherLang/PHP/001\"},{\"text\":\"002-本机安装ThinkCMF系统\",\"link\":\"/column/OtherLang/PHP/002\"},{\"text\":\"003-ThinkCMF门户应用安装\",\"link\":\"/column/OtherLang/PHP/003\"}]}],\"/column/BaseCommand/\":[{\"text\":\"Windows快捷键\",\"items\":[{\"text\":\"001-vscode快捷键\",\"link\":\"/column/BaseCommand/WinShortcutKey/001\"},{\"text\":\"002-Windows快捷键\",\"link\":\"/column/BaseCommand/WinShortcutKey/002\"},{\"text\":\"003-Notion快捷键\",\"link\":\"/column/BaseCommand/WinShortcutKey/003\"},{\"text\":\"004-Potplayer快捷键\",\"link\":\"/column/BaseCommand/WinShortcutKey/004\"}]},{\"text\":\"MacOS快捷键\",\"items\":[{\"text\":\"001-vscode快捷键\",\"link\":\"/column/BaseCommand/MacShortcutKey/001_vscode\"},{\"text\":\"002-MacOS快捷键\",\"link\":\"/column/BaseCommand/MacShortcutKey/002_macos\"},{\"text\":\"003-控制台快捷键\",\"link\":\"/column/BaseCommand/MacShortcutKey/003_console\"},{\"text\":\"004-Google快捷键\",\"link\":\"/column/BaseCommand/MacShortcutKey/004_google\"},{\"text\":\"005-Typora快捷键\",\"link\":\"/column/BaseCommand/MacShortcutKey/005_typora\"},{\"text\":\"006-Notion快捷键\",\"link\":\"/column/BaseCommand/MacShortcutKey/006_notion\"},{\"text\":\"007-Git命令\",\"link\":\"/column/BaseCommand/MacShortcutKey/007_git\"},{\"text\":\"008-Linux命令\",\"link\":\"/column/BaseCommand/MacShortcutKey/008_linux\"},{\"text\":\"009-飞书文档\",\"link\":\"/column/BaseCommand/MacShortcutKey/009_lark\"}]}],\"/column/Template\":[{\"text\":\"notion模板\",\"items\":[]}],\"/column/Growing/\":[{\"text\":\"年度总结\",\"items\":[{\"text\":\"001-2023年终总结\",\"link\":\"/column/Growing/YearSummary/001\"}]},{\"text\":\"复盘总结\",\"items\":[{\"text\":\"001-2023复盘总结\",\"link\":\"/column/Growing/ReviewSummary/001\"}]},{\"text\":\"自我提升\",\"items\":[]}],\"/column/Travel/\":[{\"text\":\"华东地区\",\"items\":[]},{\"text\":\"华南地区\",\"items\":[]},{\"text\":\"华北地区\",\"items\":[]}],\"/column/Product/\":[{\"text\":\"软件工程\",\"items\":[{\"text\":\"000-学习指南\",\"link\":\"/column/Product/SoftwareEngineer/000Guide\"},{\"text\":\"001-软件是什么\",\"link\":\"/column/Product/SoftwareEngineer/001Definition\"},{\"text\":\"002-软件过程模型\",\"link\":\"/column/Product/SoftwareEngineer/002ProcessModel\"},{\"text\":\"003-三种原型实现模型\",\"link\":\"/column/Product/SoftwareEngineer/003Prototype\"},{\"text\":\"004-软件项目管理中的4P\",\"link\":\"/column/Product/SoftwareEngineer/004Product\"},{\"text\":\"005-软件的度量\",\"link\":\"/column/Product/SoftwareEngineer/005Measure\"},{\"text\":\"006-软件范围与估算\",\"link\":\"/column/Product/SoftwareEngineer/006Scope\"},{\"text\":\"007-风险分析与管理\",\"link\":\"/column/Product/SoftwareEngineer/007RiskAnalysis\"},{\"text\":\"008-软件项目进度安排与跟踪\",\"link\":\"/column/Product/SoftwareEngineer/008Schedule\"},{\"text\":\"009-结构化系统分析\",\"link\":\"/column/Product/SoftwareEngineer/009StructuredAnalysis\"},{\"text\":\"010-数据流图和字典案例分析\",\"link\":\"/column/Product/SoftwareEngineer/010DataFlowDiagram\"},{\"text\":\"011-结构化系统设计\",\"link\":\"/column/Product/SoftwareEngineer/011StructuredDesign\"},{\"text\":\"012-软件测试\",\"link\":\"/column/Product/SoftwareEngineer/012SoftwareTest\"},{\"text\":\"013-统一建模语言UML\",\"link\":\"/column/Product/SoftwareEngineer/013UML\"}]},{\"text\":\"软件测试\",\"items\":[{\"text\":\"001-软件测试基础知识\",\"link\":\"/column/Product/SoftwareTesting/001\"},{\"text\":\"002-黑盒测试和测试用例基础知识\",\"link\":\"/column/Product/SoftwareTesting/002\"},{\"text\":\"003-8种黑盒测试方法\",\"link\":\"/column/Product/SoftwareTesting/003\"},{\"text\":\"004-4种白盒测试方法\",\"link\":\"/column/Product/SoftwareTesting/004\"},{\"text\":\"005-性能测试\",\"link\":\"/column/Product/SoftwareTesting/005\"},{\"text\":\"006-安全测试\",\"link\":\"/column/Product/SoftwareTesting/006\"}]}],\"/column/ArtificialIntelligence/\":[{\"text\":\"机器学习\",\"items\":[{\"text\":\"000-学习指南\",\"link\":\"/column/Product/SoftwareEngineer/000Guide\"}]},{\"text\":\"深度学习\",\"items\":[{\"text\":\"001-软件测试基础知识\",\"link\":\"/column/Product/SoftwareTesting/001\"}]}],\"/article/frontend/react/\":[{\"text\":\"基础知识\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.邂逅React\",\"link\":\"/article/frontend/react/基础知识/1.邂逅React\"}]},{\"text\":\"Hooks详解\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.useCallback和useMemo\",\"link\":\"/article/frontend/react/Hooks详解/1.useCallback和useMemo\"},{\"text\":\"2.useRef使用\",\"link\":\"/article/frontend/react/Hooks详解/2.useRef使用\"}]},{\"text\":\"我的模板\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.TS-template\",\"link\":\"/article/frontend/react/我的模板/1.TS-template\"}]}],\"/article/frontend/next/\":[{\"text\":\"基础知识\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.安装使用\",\"link\":\"/article/frontend/next/基础知识/1.安装使用\"},{\"text\":\"2.路由系统\",\"link\":\"/article/frontend/next/基础知识/2.路由系统\"},{\"text\":\"3.渲染\",\"link\":\"/article/frontend/next/基础知识/3.渲染\"}]}],\"/article/frontend/tauri/\":[{\"text\":\"特性\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.commands指令系统\",\"link\":\"/article/frontend/tauri/特性/1.commands指令系统\"},{\"text\":\"2.事件\",\"link\":\"/article/frontend/tauri/特性/2.事件\"},{\"text\":\"3.图标\",\"link\":\"/article/frontend/tauri/特性/3.图标\"},{\"text\":\"4.窗口菜单栏\",\"link\":\"/article/frontend/tauri/特性/4.窗口菜单栏\"},{\"text\":\"5.多窗口\",\"link\":\"/article/frontend/tauri/特性/5.多窗口\"},{\"text\":\"6.插件系统(Todo)\",\"link\":\"/article/frontend/tauri/特性/6.插件系统(Todo)\"},{\"text\":\"7.初始化屏幕\",\"link\":\"/article/frontend/tauri/特性/7.初始化屏幕\"},{\"text\":\"8.系统托盘\",\"link\":\"/article/frontend/tauri/特性/8.系统托盘\"},{\"text\":\"9.窗口自定义\",\"link\":\"/article/frontend/tauri/特性/9.窗口自定义\"}]}],\"/article/frontend/css/\":[{\"text\":\"移动端适配\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.邂逅移动端\",\"link\":\"/article/frontend/css/移动端适配/1.邂逅移动端\"},{\"text\":\"2.视口\",\"link\":\"/article/frontend/css/移动端适配/2.视口\"},{\"text\":\"3.适配方案\",\"link\":\"/article/frontend/css/移动端适配/3.适配方案\"}]}],\"/article/backend/nestjs/\":[{\"text\":\"NestJS基础\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.九大核心概念\",\"link\":\"/article/backend/nestjs/NestJS基础/1.九大核心概念\"},{\"text\":\"2.核心概念小结\",\"link\":\"/article/backend/nestjs/NestJS基础/2.核心概念小结\"},{\"text\":\"3.ExecutionContext补充\",\"link\":\"/article/backend/nestjs/NestJS基础/3.ExecutionContext补充\"}]},{\"text\":\"NestJS进阶\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.依赖注入\",\"link\":\"/article/backend/nestjs/NestJS进阶/1.依赖注入\"},{\"text\":\"2.生命周期\",\"link\":\"/article/backend/nestjs/NestJS进阶/2.生命周期\"},{\"text\":\"3.打包部署(⚑)\",\"link\":\"/article/backend/nestjs/NestJS进阶/3.打包部署(⚑)\"},{\"text\":\"4.环境变量\",\"link\":\"/article/backend/nestjs/NestJS进阶/4.环境变量\"},{\"text\":\"5.整合prisma(todo)\",\"link\":\"/article/backend/nestjs/NestJS进阶/5.整合prisma(todo)\"},{\"text\":\"6.缓存(todo)\",\"link\":\"/article/backend/nestjs/NestJS进阶/6.缓存(todo)\"}]},{\"text\":\"安全认证\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.登录认证(JWT)\",\"link\":\"/article/backend/nestjs/安全认证/1.登录认证(JWT)\"}]},{\"text\":\"实用工具包\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.class-transformer\",\"link\":\"/article/backend/nestjs/实用工具包/1.class-transformer\"}]}],\"/article/backend/nginx/\":[{\"text\":\"基础知识\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.连接状态模块\",\"link\":\"/article/backend/nginx/基础知识/1.连接状态模块\"},{\"text\":\"2.随机主页模块\",\"link\":\"/article/backend/nginx/基础知识/2.随机主页模块\"},{\"text\":\"3.替换模块\",\"link\":\"/article/backend/nginx/基础知识/3.替换模块\"},{\"text\":\"4.文件读取模块\",\"link\":\"/article/backend/nginx/基础知识/4.文件读取模块\"},{\"text\":\"5.文件压缩模块\",\"link\":\"/article/backend/nginx/基础知识/5.文件压缩模块\"},{\"text\":\"6.页面缓存模块\",\"link\":\"/article/backend/nginx/基础知识/6.页面缓存模块\"}]},{\"text\":\"配置相关\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.默认配置\",\"link\":\"/article/backend/nginx/配置相关/1.默认配置\"},{\"text\":\"2.主配置文件\",\"link\":\"/article/backend/nginx/配置相关/2.主配置文件\"},{\"text\":\"3.子配置目录\",\"link\":\"/article/backend/nginx/配置相关/3.子配置目录\"},{\"text\":\"4.location参数\",\"link\":\"/article/backend/nginx/配置相关/4.location参数\"},{\"text\":\"5.代理\",\"link\":\"/article/backend/nginx/配置相关/5.代理\"},{\"text\":\"6.proxy代理\",\"link\":\"/article/backend/nginx/配置相关/6.proxy代理\"}]},{\"text\":\"其它\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.日志\",\"link\":\"/article/backend/nginx/其它/1.日志\"},{\"text\":\"2.文件关联程序\",\"link\":\"/article/backend/nginx/其它/2.文件关联程序\"},{\"text\":\"3.HTTP状态码\",\"link\":\"/article/backend/nginx/其它/3.HTTP状态码\"}]}],\"/article/backend/gitLearn/\":[{\"text\":\"基本配置\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.初识配置\",\"link\":\"/article/backend/gitLearn/基本配置/1.初识配置\"},{\"text\":\"2.配置别名\",\"link\":\"/article/backend/gitLearn/基本配置/2.配置别名\"},{\"text\":\"3.Git原理图\",\"link\":\"/article/backend/gitLearn/基本配置/3.Git原理图\"}]},{\"text\":\"常用命令\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.常用命令\",\"link\":\"/article/backend/gitLearn/常用命令/1.常用命令\"},{\"text\":\"2.工作区和暂存区\",\"link\":\"/article/backend/gitLearn/常用命令/2.工作区和暂存区\"},{\"text\":\"3.分支管理\",\"link\":\"/article/backend/gitLearn/常用命令/3.分支管理\"},{\"text\":\"4.reset指令\",\"link\":\"/article/backend/gitLearn/常用命令/4.reset指令\"},{\"text\":\"5.stashing临时存储工作\",\"link\":\"/article/backend/gitLearn/常用命令/5.stashing临时存储工作\"},{\"text\":\"6.Tag打标签\",\"link\":\"/article/backend/gitLearn/常用命令/6.Tag打标签\"},{\"text\":\"7.git动画(精品☆)\",\"link\":\"/article/backend/gitLearn/常用命令/7.git动画(精品☆)\"}]},{\"text\":\"远程仓库\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.github仓库\",\"link\":\"/article/backend/gitLearn/远程仓库/1.github仓库\"},{\"text\":\"2.pull拉取更新\",\"link\":\"/article/backend/gitLearn/远程仓库/2.pull拉取更新\"},{\"text\":\"3.push命令\",\"link\":\"/article/backend/gitLearn/远程仓库/3.push命令\"}]},{\"text\":\"其它工具\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.degit文档\",\"link\":\"/article/backend/gitLearn/其它工具/1.degit文档\"}]}],\"/article/backend/nodejs/\":[{\"text\":\"包管理工具\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.软连接和硬链接\",\"link\":\"/article/backend/nodejs/包管理工具/1.软连接和硬链接\"},{\"text\":\"2.pnpm使用\",\"link\":\"/article/backend/nodejs/包管理工具/2.pnpm使用\"},{\"text\":\"3.npm安装离线包\",\"link\":\"/article/backend/nodejs/包管理工具/3.npm安装离线包\"}]}],\"/article/backend/CPP/\":[{\"text\":\"基础知识\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.Cherno教程\",\"link\":\"/article/backend/CPP/基础知识/1.Cherno教程\"},{\"text\":\"2.自学总结\",\"link\":\"/article/backend/CPP/基础知识/2.自学总结\"},{\"text\":\"3.C++ Primer语录集\",\"link\":\"/article/backend/CPP/基础知识/3.C++ Primer语录集\"},{\"text\":\"4.侯捷\",\"link\":\"/article/backend/CPP/基础知识/4.侯捷\"},{\"text\":\"5.CMake教程\",\"link\":\"/article/backend/CPP/基础知识/5.CMake教程\"}]},{\"text\":\"QT\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.元对象系统\",\"link\":\"/article/backend/CPP/QT/1.元对象系统\"},{\"text\":\"2.配置相关\",\"link\":\"/article/backend/CPP/QT/2.配置相关\"},{\"text\":\"3.模型视图\",\"link\":\"/article/backend/CPP/QT/3.模型视图\"},{\"text\":\"4.事件系统\",\"link\":\"/article/backend/CPP/QT/4.事件系统\"}]}],\"/article/backend/Csharp/\":[{\"text\":\"基础知识\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.MAUI相关\",\"link\":\"/article/backend/Csharp/基础知识/1.MAUI相关\"}]}],\"/article/bigMan/\":[{\"text\":\"工具网站\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.科学上网\",\"link\":\"/article/bigMan/工具网站/1.科学上网\"},{\"text\":\"2.密码小能手\",\"link\":\"/article/bigMan/工具网站/2.密码小能手\"},{\"text\":\"3.音视频小能手\",\"link\":\"/article/bigMan/工具网站/3.音视频小能手\"},{\"text\":\"4.绘图小能手\",\"link\":\"/article/bigMan/工具网站/4.绘图小能手\"},{\"text\":\"5.图床\",\"link\":\"/article/bigMan/工具网站/5.图床\"},{\"text\":\"6.正则大全\",\"link\":\"/article/bigMan/工具网站/6.正则大全\"},{\"text\":\"7.automa自动化工具\",\"link\":\"/article/bigMan/工具网站/7.automa自动化工具\"},{\"text\":\"8.欧陆词典破解\",\"link\":\"/article/bigMan/工具网站/8.欧陆词典破解\"},{\"text\":\"9.QQ机器人\",\"link\":\"/article/bigMan/工具网站/9.QQ机器人\"}]}],\"/article/bug/\":[{\"text\":\"服务器\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1-SSH\",\"link\":\"/article/bug/服务器/1-SSH\"},{\"text\":\"2-linux\",\"link\":\"/article/bug/服务器/2-linux\"},{\"text\":\"3-vscode\",\"link\":\"/article/bug/服务器/3-vscode\"},{\"text\":\"4-mysql\",\"link\":\"/article/bug/服务器/4-mysql\"}]}],\"/article/colorfulLife/\":[{\"text\":\"杂七杂八\",\"collapsible\":true,\"collapsed\":false,\"items\":[{\"text\":\"1.vitepress侧边栏生成脚本\",\"link\":\"/article/colorfulLife/杂七杂八/1.vitepress侧边栏生成脚本\"},{\"text\":\"2.ideavim配置\",\"link\":\"/article/colorfulLife/杂七杂八/2.ideavim配置\"},{\"text\":\"3.爬虫和js逆向\",\"link\":\"/article/colorfulLife/杂七杂八/3.爬虫和js逆向\"}]}]},\"outline\":{\"level\":[1,6],\"label\":\"目录\"},\"outlineTitle\":\"大纲目录\",\"lastUpdatedText\":\"最近更新时间\",\"search\":{\"provider\":\"local\"},\"i18nRouting\":true,\"socialLinks\":[{\"icon\":{\"svg\":\"<svg t=\\\"1671070837286\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"878\\\" width=\\\"200\\\" height=\\\"200\\\"><path d=\\\"M465.189 161.792c-22.967 18.14-44.325 35.109-47.397 37.742l-5.851 4.68 10.971 8.632c5.998 4.827 11.85 9.508 13.02 10.532 1.17 1.024 17.993 14.336 37.156 29.696l34.962 27.795 5.267-3.95c2.925-2.194 23.259-18.432 45.348-35.986 21.943-17.555 41.253-32.768 42.716-33.646 1.609-1.024 2.779-2.194 2.779-2.78 0-0.438-9.655-8.63-21.504-17.846-11.995-9.363-22.674-17.847-23.845-18.871-15.945-13.02-49.737-39.059-50.76-39.059-0.586 0.147-19.896 14.922-42.862 33.061z m233.325 180.37C507.465 493.275 508.928 492.105 505.417 489.911c-3.072-1.902-11.556-8.485-64.073-50.03-9.07-7.168-18.578-14.775-21.358-16.823-2.78-2.194-8.777-6.875-13.312-10.532-4.68-3.657-10.679-8.339-13.312-10.533-13.165-10.24-71.095-56.027-102.107-80.457-5.852-4.681-11.41-8.485-12.142-8.485-0.731 0-10.971 7.754-22.674 17.116-11.703 9.508-22.674 18.286-24.284 19.456-1.755 1.17-5.12 3.95-7.46 6.144-2.34 2.34-4.828 4.096-5.413 4.096-3.072 0-0.731 3.072 6.437 8.777 4.096 3.218 8.777 6.875 10.094 8.046 1.316 1.024 10.24 8.045 19.748 15.506s23.26 18.286 30.428 23.99c19.31 15.215 31.89 25.308 127.853 101.084 47.836 37.742 88.796 69.779 90.844 71.095 3.657 2.487 3.95 2.487 7.46-0.292a1041.42 1041.42 0 0 0 16.092-12.727c6.875-5.413 14.775-11.703 17.554-13.897 30.135-23.699 80.018-63.05 81.774-64.512 1.17-1.024 12.434-9.802 24.868-19.603s37.888-29.696 56.32-44.324c18.579-14.629 46.227-36.425 61.733-48.567 15.506-12.142 27.794-22.528 27.502-23.26-0.878-1.17-57.637-47.104-59.978-48.274-0.731-0.439-18.578 12.727-39.497 29.257z\\\" fill=\\\"#006CFF\\\" p-id=\\\"879\\\"></path><path d=\\\"M57.93 489.326c-15.215 12.288-28.527 23.405-29.697 24.576-2.34 2.194-5.412-0.44 80.018 66.852 33.207 26.185 32.622 25.747 57.637 45.495 10.386 8.192 36.279 28.672 57.783 45.495 38.18 30.135 44.91 35.401 52.663 41.545 2.048 1.756 22.967 18.14 46.372 36.572 23.26 18.432 74.167 58.514 112.933 89.088 38.912 30.573 71.095 55.734 71.826 56.027 0.732 0.293 7.46-4.389 14.921-10.386 21.797-16.97 90.259-70.949 101.523-79.872 5.705-4.535 12.873-10.24 15.945-12.58 3.072-2.488 6.436-5.12 7.314-5.852 0.878-0.878 11.85-9.509 24.283-19.31 20.773-16.091 59.1-46.226 64.366-50.615 1.17-1.024 5.12-4.096 8.777-6.875 3.657-2.78 7.9-6.29 9.509-7.607 1.609-1.317 14.775-11.703 29.257-23.113 29.11-22.82 42.277-33.207 88.503-69.632 17.262-13.605 32.475-25.454 33.646-26.478 2.486-2.048 31.451-24.869 44.617-35.255 4.827-3.657 9.07-7.168 9.508-7.607 0.44-0.585 5.998-4.827 12.435-9.8 6.436-4.828 13.165-10.24 15.067-11.85l3.365-2.926-9.948-7.753c-5.412-4.388-10.24-8.192-10.679-8.63-1.17-1.317-22.381-18.433-30.135-24.284-3.95-3.072-7.314-5.998-7.606-6.73-1.317-3.071-6.73 0.147-29.258 17.994-13.458 10.532-25.746 20.187-27.355 21.504-1.61 1.463-10.533 8.338-19.749 15.652-9.216 7.168-17.115 13.459-17.554 13.898-0.439 0.438-6.583 5.412-13.897 10.971-7.168 5.559-15.214 11.703-17.7 13.75-4.974 4.097-5.413 4.39-20.334 16.239-5.56 4.388-11.264 8.777-12.435 9.8-1.17 1.025-20.333 16.092-42.422 33.354-22.09 17.408-41.546 32.768-43.155 34.084-1.609 1.463-14.482 11.557-28.525 22.528s-40.814 32.037-59.539 46.812c-18.578 14.775-42.276 33.353-52.516 41.399s-23.26 18.285-28.965 22.82l-10.386 8.339-4.389-3.072c-2.34-1.756-4.68-3.511-5.12-3.95-0.439-0.439-4.973-4.096-10.24-8.046-11.849-9.216-14.482-11.264-16.676-13.166-0.878-0.877-4.243-3.51-7.46-5.851-3.22-2.487-6.145-4.681-6.584-5.12-0.439-0.439-6.875-5.705-14.482-11.703-7.607-5.851-14.921-11.556-16.091-12.58-1.317-1.17-17.116-13.605-35.255-27.795-17.993-14.19-35.109-27.648-38.035-29.842-5.705-4.681-33.499-26.624-125.074-98.743-34.523-27.209-72.704-57.344-84.846-66.852-49.737-39.498-55.15-43.594-56.905-43.447-0.877 0-14.043 10.24-29.257 22.528z\\\" fill=\\\"#006CFF\\\" p-id=\\\"880\\\"></path></svg>\"},\"link\":\"https://juejin.cn/user/822915483571063\"},{\"icon\":{\"svg\":\"<svg t=\\\"1671071196762\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"1978\\\" width=\\\"200\\\" height=\\\"200\\\"><path d=\\\"M932.317184 567.76704L885.10464 422.46144l-93.57312-287.997952c-4.8128-14.81728-25.776128-14.81728-30.590976 0L667.36128 422.459392H356.62848L263.051264 134.46144c-4.8128-14.81728-25.776128-14.81728-30.593024 0l-93.57312 287.997952-47.210496 145.309696a32.165888 32.165888 0 0 0 11.68384 35.96288l408.6272 296.890368L920.61696 603.734016c11.272192-8.192 15.990784-22.71232 11.68384-35.964928\\\" fill=\\\"#FC6D26\\\" p-id=\\\"1979\\\"></path><path d=\\\"M512.002048 900.62848l155.365376-478.171136H356.634624z\\\" fill=\\\"#E24329\\\" p-id=\\\"1980\\\"></path><path d=\\\"M512.004096 900.62848L356.63872 422.47168H138.901504z\\\" fill=\\\"#FC6D26\\\" p-id=\\\"1981\\\"></path><path d=\\\"M138.891264 422.465536l-47.214592 145.309696a32.16384 32.16384 0 0 0 11.685888 35.96288L511.991808 900.62848z\\\" fill=\\\"#FCA326\\\" p-id=\\\"1982\\\"></path><path d=\\\"M138.893312 422.459392h217.737216L263.053312 134.46144c-4.8128-14.819328-25.778176-14.819328-30.590976 0z\\\" fill=\\\"#E24329\\\" p-id=\\\"1983\\\"></path><path d=\\\"M512.002048 900.62848l155.365376-478.154752H885.10464z\\\" fill=\\\"#FC6D26\\\" p-id=\\\"1984\\\"></path><path d=\\\"M885.11488 422.465536l47.214592 145.309696a32.16384 32.16384 0 0 1-11.685888 35.96288L512.014336 900.62848z\\\" fill=\\\"#FCA326\\\" p-id=\\\"1985\\\"></path><path d=\\\"M885.096448 422.459392H667.36128l93.577216-287.997952c4.814848-14.819328 25.778176-14.819328 30.590976 0z\\\" fill=\\\"#E24329\\\" p-id=\\\"1986\\\"></path></svg>\"},\"link\":\"https://gitee.com/Angelxyj\"},{\"icon\":\"github\",\"link\":\"https://github.com/Angelxyj\"}],\"editLink\":{\"pattern\":\"https://github.com/Angelxyj/xuxuaimo.guide/edit/main/docs/:path\",\"text\":\"Edit this page on Github\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2021 Coder 许小墨\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>